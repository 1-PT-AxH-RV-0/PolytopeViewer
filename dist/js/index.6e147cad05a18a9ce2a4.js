!function(){var e,t,o,i,r={7074:function(e,t,o){var i={"./polychora/BitruncatedRegularConvex/Bitruncated_hecatonicosachoron.off":[7937,7937],"./polychora/BitruncatedRegularConvex/Bitruncated_icositetrachoron.off":[2531,2531],"./polychora/BitruncatedRegularConvex/Bitruncated_pentachoron.off":[4674,4674],"./polychora/BitruncatedRegularConvex/Bitruncated_tesseract.off":[8145,8145],"./polychora/BitruncatedSchläfliHess/Dahi(btga120).off":[152,152],"./polychora/BitruncatedSchläfliHess/Gixhi(btgags120).off":[8535,8535],"./polychora/BitruncatedSchläfliHess/Shihi(btf600).off":[1290,1290],"./polychora/CantellatedRegularConvex/Cantellated_hecatonicosachoron.off":[7257,7257],"./polychora/CantellatedRegularConvex/Cantellated_hexacosichoron.off":[3468,3468],"./polychora/CantellatedRegularConvex/Cantellated_icositetrachoron.off":[9883,9883],"./polychora/CantellatedRegularConvex/Cantellated_pentachoron.off":[8410,8410],"./polychora/CantellatedRegularConvex/Cantellated_tesseract.off":[8665,8665],"./polychora/CantellatedSchläfliHess/Sirfix.off":[1699,1699],"./polychora/CantellatedSchläfliHess/Sirgaghi.off":[3320,3320],"./polychora/CantellatedSchläfliHess/Sirgashi.off":[1108,1108],"./polychora/CantellatedSchläfliHess/Sirgax.off":[4574,4574],"./polychora/CantellatedSchläfliHess/Sirghi.off":[7236,7236],"./polychora/CantellatedSchläfliHess/Sirsashi.off":[4632,4632],"./polychora/CantellatedSchläfliHess/Sraghi.off":[6970,6970],"./polychora/CantitruncatedRegularConvex/Cantitruncated_hecatonicosachoron.off":[6219,6219],"./polychora/CantitruncatedRegularConvex/Cantitruncated_hexacosichoron.off":[3866,3866],"./polychora/CantitruncatedRegularConvex/Cantitruncated_icositetrachoron.off":[925,925],"./polychora/CantitruncatedRegularConvex/Cantitruncated_pentachoron.off":[4668,4668],"./polychora/CantitruncatedRegularConvex/Cantitruncated_tesseract.off":[83,83],"./polychora/CantitruncatedSchläfliHess/Girfix.off":[2573,2573],"./polychora/CantitruncatedSchläfliHess/Graggix.off":[9401,9401],"./polychora/CantitruncatedSchläfliHess/Graghi.off":[2260,2260],"./polychora/OmnitruncatedRegularConvex/Omnitruncated_hecatonicosachoron.off":[3401,3401],"./polychora/OmnitruncatedRegularConvex/Omnitruncated_icositetrachoron.off":[3371,3371],"./polychora/OmnitruncatedRegularConvex/Omnitruncated_pentachoron.off":[6538,6538],"./polychora/OmnitruncatedRegularConvex/Omnitruncated_tesseract.off":[1561,1561],"./polychora/RectifiedRegularConvex/Rectified_hecatonicosachoron.off":[3973,3973],"./polychora/RectifiedRegularConvex/Rectified_hexacosichoron.off":[5616,5616],"./polychora/RectifiedRegularConvex/Rectified_icositetrachoron.off":[1999,1999],"./polychora/RectifiedRegularConvex/Rectified_pentachoron.off":[3502,3502],"./polychora/RectifiedRegularConvex/Rectified_tesseract.off":[7357,7357],"./polychora/RectifiedSchläfliHess/Ragaghi.off":[2309,2309],"./polychora/RectifiedSchläfliHess/Ragashi.off":[1337,1337],"./polychora/RectifiedSchläfliHess/Raggix.off":[9018,9018],"./polychora/RectifiedSchläfliHess/Raghi.off":[5605,5605],"./polychora/RectifiedSchläfliHess/Ragishi.off":[8993,8993],"./polychora/RectifiedSchläfliHess/Rasishi.off":[8245,8245],"./polychora/RectifiedSchläfliHess/Rigfix.off":[4223,4223],"./polychora/RectifiedSchläfliHess/Righi.off":[6909,6909],"./polychora/RectifiedSchläfliHess/Rigogishi.off":[9871,9871],"./polychora/RectifiedSchläfliHess/Rofix.off":[712,712],"./polychora/RegularConvex/Hecatonicosachoron.off":[6574,6574],"./polychora/RegularConvex/Hexacosichoron.off":[4491,4491],"./polychora/RegularConvex/Hexadecachoron.off":[4660,4660],"./polychora/RegularConvex/Icositetrachoron.off":[5228,5228],"./polychora/RegularConvex/Pentachoron.off":[9923,9923],"./polychora/RegularConvex/Tesseract.off":[4316,4316],"./polychora/RuncinatedRegularConvex/Runcinated_hecatonicosachoron.off":[3931,3931],"./polychora/RuncinatedRegularConvex/Runcinated_icositetrachoron.off":[4045,4045],"./polychora/RuncinatedRegularConvex/Runcinated_pentachoron.off":[5644,5644],"./polychora/RuncinatedRegularConvex/Runcinated_tesseract.off":[9987,9987],"./polychora/RuncinatedSchläfliHess/Runcinated_facted_hexacosichoron.off":[6931,6931],"./polychora/RuncinatedSchläfliHess/Runcinated_great_grand_stellated_hecatonicosachoron.off":[3958,3958],"./polychora/RuncitruncatedRegularConvex/Runcitruncated_hecatonicosachoron.off":[507,507],"./polychora/RuncitruncatedRegularConvex/Runcitruncated_hexacosichoron.off":[9322,9322],"./polychora/RuncitruncatedRegularConvex/Runcitruncated_hexadecachoron.off":[1429,1429],"./polychora/RuncitruncatedRegularConvex/Runcitruncated_icositetrachoron.off":[5965,5965],"./polychora/RuncitruncatedRegularConvex/Runcitruncated_pentachoron.off":[9932,9932],"./polychora/RuncitruncatedRegularConvex/Runcitruncated_tesseract.off":[243,243],"./polychora/SchläfliHess/Fix.off":[1542,1542],"./polychora/SchläfliHess/Gaghi.off":[2453,2453],"./polychora/SchläfliHess/Gahi.off":[5430,5430],"./polychora/SchläfliHess/Gashi.off":[7401,7401],"./polychora/SchläfliHess/Gax.off":[9835,9835],"./polychora/SchläfliHess/Gishi.off":[2129,2129],"./polychora/SchläfliHess/Gofix.off":[328,328],"./polychora/SchläfliHess/Gogishi.off":[7367,7367],"./polychora/SchläfliHess/Gohi.off":[1120,1120],"./polychora/SchläfliHess/Sishi.off":[3810,3810],"./polychora/TruncatedRegularConvex/Tat.off":[9981,9981],"./polychora/TruncatedRegularConvex/Tex.off":[9469,9469],"./polychora/TruncatedRegularConvex/Thex.off":[787,787],"./polychora/TruncatedRegularConvex/Thi.off":[4291,4291],"./polychora/TruncatedRegularConvex/Tico.off":[5327,5327],"./polychora/TruncatedRegularConvex/Tip.off":[5433,5433],"./polychora/TruncatedSchläfliHess/Taggix.off":[4999,4999],"./polychora/TruncatedSchläfliHess/Taghi.off":[4810,4810],"./polychora/TruncatedSchläfliHess/Tiffix.off":[2893,2893],"./polychora/TruncatedSchläfliHess/Tigaghi.off":[1114,1114],"./polychora/TruncatedSchläfliHess/Tigfix.off":[6930,6930],"./polychora/TruncatedSchläfliHess/Tighi.off":[8834,8834],"./polyhedra/Archimedean/Cuboctahedron.off":[5842,5842],"./polyhedra/Archimedean/Great_rhombicosidodecahedron.off":[3404,3404],"./polyhedra/Archimedean/Great_rhombicuboctahedron.off":[7567,7567],"./polyhedra/Archimedean/Icosidodecahedron.off":[8926,8926],"./polyhedra/Archimedean/Small_rhombicosidodecahedron.off":[1954,1954],"./polyhedra/Archimedean/Small_rhombicuboctahedron.off":[7477,7477],"./polyhedra/Archimedean/Snub_cube.off":[5261,5261],"./polyhedra/Archimedean/Snub_dodecahedron.off":[356,356],"./polyhedra/Archimedean/Truncated_cube.off":[3125,3125],"./polyhedra/Archimedean/Truncated_dodecahedron.off":[1100,1100],"./polyhedra/Archimedean/Truncated_icosahedron.off":[3419,3419],"./polyhedra/Archimedean/Truncated_octahedron.off":[3761,3761],"./polyhedra/Archimedean/Truncated_tetrahedron.off":[9976,9976],"./polyhedra/Catalan/Deltoidal_hexecontahedron.off":[2834,2834],"./polyhedra/Catalan/Deltoidal_icositetrahedron.off":[6998,6998],"./polyhedra/Catalan/Disdyakis_dodecahedron.off":[8558,8558],"./polyhedra/Catalan/Disdyakis_triacontahedron.off":[7267,7267],"./polyhedra/Catalan/Pentagonal_hexecontahedron.off":[4091,4091],"./polyhedra/Catalan/Pentagonal_icositetrahedron.off":[4533,4533],"./polyhedra/Catalan/Pentakis_dodecahedron.off":[9598,9598],"./polyhedra/Catalan/Rhombic_dodecahedron.off":[2437,2437],"./polyhedra/Catalan/Rhombic_triacontahedron.off":[198,198],"./polyhedra/Catalan/Tetrakis_cube.off":[7255,7255],"./polyhedra/Catalan/Triakis_icosahedron.off":[8683,8683],"./polyhedra/Catalan/Triakis_octahedron.off":[3889,3889],"./polyhedra/Catalan/Triakis_tetrahedron.off":[6088,6088],"./polyhedra/Comp/10Oct1st.off":[2364,2364],"./polyhedra/Comp/10Oct2nd.off":[5064,5064],"./polyhedra/Comp/10Tet.off":[2191,2191],"./polyhedra/Comp/12Pap.off":[1669,1669],"./polyhedra/Comp/12Starp.off":[1906,1906],"./polyhedra/Comp/12Tet.off":[6145,6145],"./polyhedra/Comp/20Oct.off":[6981,6981],"./polyhedra/Comp/20Thah.off":[2616,2616],"./polyhedra/Comp/2Tet.off":[2752,2752],"./polyhedra/Comp/3Cube.off":[8025,8025],"./polyhedra/Comp/4Oct.off":[2535,2535],"./polyhedra/Comp/5Cube.off":[387,387],"./polyhedra/Comp/5Oct.off":[8864,8864],"./polyhedra/Comp/5Tet.off":[4437,4437],"./polyhedra/Comp/5Thah.off":[4739,4739],"./polyhedra/Comp/6Cube.off":[5944,5944],"./polyhedra/Comp/6Pap.off":[4312,4312],"./polyhedra/Comp/6Starp.off":[9319,9319],"./polyhedra/Comp/6Tet.off":[6676,6676],"./polyhedra/Comp/8Oct.off":[5187,5187],"./polyhedra/Johnson/Augmented_dodecahedron.off":[6066,6066],"./polyhedra/Johnson/Augmented_hexagonal_prism.off":[8455,8455],"./polyhedra/Johnson/Augmented_pentagonal_prism.off":[4773,4773],"./polyhedra/Johnson/Augmented_sphenocorona.off":[6345,6345],"./polyhedra/Johnson/Augmented_triangular_prism.off":[5477,5477],"./polyhedra/Johnson/Augmented_tridiminished_icosahedron.off":[4774,2393],"./polyhedra/Johnson/Augmented_truncated_cube.off":[6402,6402],"./polyhedra/Johnson/Augmented_truncated_dodecahedron.off":[8819,8819],"./polyhedra/Johnson/Augmented_truncated_tetrahedron.off":[7557,7557],"./polyhedra/Johnson/Biaugmented_pentagonal_prism.off":[6018,6018],"./polyhedra/Johnson/Biaugmented_triangular_prism.off":[2558,2558],"./polyhedra/Johnson/Biaugmented_truncated_cube.off":[8293,8293],"./polyhedra/Johnson/Bigyrate_diminished_rhombicosidodecahedron.off":[8837,8837],"./polyhedra/Johnson/Bilunabirotunda.off":[7216,7216],"./polyhedra/Johnson/Diminished_rhombicosidodecahedron.off":[8629,8629],"./polyhedra/Johnson/Disphenocingulum.off":[3965,3965],"./polyhedra/Johnson/Elongated_pentagonal_bipyramid.off":[5084,5084],"./polyhedra/Johnson/Elongated_pentagonal_cupola.off":[3663,3663],"./polyhedra/Johnson/Elongated_pentagonal_gyrobicupola.off":[1717,1717],"./polyhedra/Johnson/Elongated_pentagonal_gyrobirotunda.off":[9048,9048],"./polyhedra/Johnson/Elongated_pentagonal_gyrocupolarotunda.off":[6647,6647],"./polyhedra/Johnson/Elongated_pentagonal_orthobicupola.off":[4830,4830],"./polyhedra/Johnson/Elongated_pentagonal_orthobirotunda.off":[2069,2069],"./polyhedra/Johnson/Elongated_pentagonal_orthocupolarotunda.off":[9198,9198],"./polyhedra/Johnson/Elongated_pentagonal_pyramid.off":[3717,3717],"./polyhedra/Johnson/Elongated_pentagonal_rotunda.off":[8098,8098],"./polyhedra/Johnson/Elongated_square_bipyramid.off":[9930,9930],"./polyhedra/Johnson/Elongated_square_cupola.off":[7241,7241],"./polyhedra/Johnson/Elongated_square_gyrobicupola.off":[207,207],"./polyhedra/Johnson/Elongated_square_pyramid.off":[119,119],"./polyhedra/Johnson/Elongated_triangular_bipyramid.off":[8416,8416],"./polyhedra/Johnson/Elongated_triangular_cupola.off":[9011,9011],"./polyhedra/Johnson/Elongated_triangular_gyrobicupola.off":[5337,5337],"./polyhedra/Johnson/Elongated_triangular_orthobicupola.off":[9378,9378],"./polyhedra/Johnson/Elongated_triangular_pyramid.off":[9305,9305],"./polyhedra/Johnson/Gyrate_bidiminished_rhombicosidodecahedron.off":[9787,9787],"./polyhedra/Johnson/Gyrate_rhombicosidodecahedron.off":[2249,2249],"./polyhedra/Johnson/Gyrobifastigium.off":[5274,5274],"./polyhedra/Johnson/Gyroelongated_pentagonal_bicupola.off":[9339,9339],"./polyhedra/Johnson/Gyroelongated_pentagonal_birotunda.off":[9990,9990],"./polyhedra/Johnson/Gyroelongated_pentagonal_cupola.off":[1540,1540],"./polyhedra/Johnson/Gyroelongated_pentagonal_cupolarotunda.off":[2993,2993],"./polyhedra/Johnson/Gyroelongated_pentagonal_pyramid.off":[9436,9436],"./polyhedra/Johnson/Gyroelongated_pentagonal_rotunda.off":[6763,6763],"./polyhedra/Johnson/Gyroelongated_square_bicupola.off":[5501,5501],"./polyhedra/Johnson/Gyroelongated_square_bipyramid.off":[5752,5752],"./polyhedra/Johnson/Gyroelongated_square_cupola.off":[4354,4354],"./polyhedra/Johnson/Gyroelongated_square_pyramid.off":[858,858],"./polyhedra/Johnson/Gyroelongated_triangular_bicupola.off":[3595,3595],"./polyhedra/Johnson/Gyroelongated_triangular_cupola.off":[7028,7028],"./polyhedra/Johnson/Hebesphenomegacorona.off":[4248,4248],"./polyhedra/Johnson/Metabiaugmented_dodecahedron.off":[5662,5662],"./polyhedra/Johnson/Metabiaugmented_hexagonal_prism.off":[8099,8099],"./polyhedra/Johnson/Metabiaugmented_truncated_dodecahedron.off":[7623,7623],"./polyhedra/Johnson/Metabidiminished_icosahedron.off":[7157,7157],"./polyhedra/Johnson/Metabidiminished_rhombicosidodecahedron.off":[6777,6777],"./polyhedra/Johnson/Metabigyrate_rhombicosidodecahedron.off":[3325,3325],"./polyhedra/Johnson/Metagyrate_diminished_rhombicosidodecahedron.off":[6485,6485],"./polyhedra/Johnson/Parabiaugmented_dodecahedron.off":[4423,4423],"./polyhedra/Johnson/Parabiaugmented_hexagonal_prism.off":[7560,7560],"./polyhedra/Johnson/Parabiaugmented_truncated_dodecahedron.off":[8572,8572],"./polyhedra/Johnson/Parabidiminished_rhombicosidodecahedron.off":[2102,2102],"./polyhedra/Johnson/Parabigyrate_rhombicosidodecahedron.off":[9890,9890],"./polyhedra/Johnson/Paragyrate_diminished_rhombicosidodecahedron.off":[2552,2552],"./polyhedra/Johnson/Pentagonal_bipyramid.off":[1934,1934],"./polyhedra/Johnson/Pentagonal_cupola.off":[2877,2877],"./polyhedra/Johnson/Pentagonal_gyrobicupola.off":[915,915],"./polyhedra/Johnson/Pentagonal_gyrocupolarotunda.off":[3817,3817],"./polyhedra/Johnson/Pentagonal_orthobicupola.off":[8568,8568],"./polyhedra/Johnson/Pentagonal_orthobirotunda.off":[8519,8519],"./polyhedra/Johnson/Pentagonal_orthocupolarotunda.off":[6236,6236],"./polyhedra/Johnson/Pentagonal_pyramid.off":[5515,5515],"./polyhedra/Johnson/Pentagonal_rotunda.off":[1952,1952],"./polyhedra/Johnson/Snub_disphenoid.off":[1575,1575],"./polyhedra/Johnson/Snub_square_antiprism.off":[5443,5443],"./polyhedra/Johnson/Sphenocorona.off":[4320,4320],"./polyhedra/Johnson/Sphenomegacorona.off":[3218,3218],"./polyhedra/Johnson/Square_cupola.off":[1031,1031],"./polyhedra/Johnson/Square_gyrobicupola.off":[7885,7885],"./polyhedra/Johnson/Square_orthobicupola.off":[7766,7766],"./polyhedra/Johnson/Square_pyramid.off":[1693,1693],"./polyhedra/Johnson/Triangular_bipyramid.off":[6466,6466],"./polyhedra/Johnson/Triangular_cupola.off":[3841,3841],"./polyhedra/Johnson/Triangular_hebesphenorotunda.off":[4597,4597],"./polyhedra/Johnson/Triangular_orthobicupola.off":[4540,4540],"./polyhedra/Johnson/Triaugmented_dodecahedron.off":[7461,7461],"./polyhedra/Johnson/Triaugmented_hexagonal_prism.off":[6542,6542],"./polyhedra/Johnson/Triaugmented_triangular_prism.off":[5138,5138],"./polyhedra/Johnson/Triaugmented_truncated_dodecahedron.off":[336,336],"./polyhedra/Johnson/Tridiminished_icosahedron.off":[4517,6898],"./polyhedra/Johnson/Tridiminished_rhombicosidodecahedron.off":[5875,8256],"./polyhedra/Johnson/Trigyrate_rhombicosidodecahedron.off":[7356,7356],"./polyhedra/KeplerPoinsot/Great_dodecahedron.off":[7587,7587],"./polyhedra/KeplerPoinsot/Great_icosahedron.off":[8846,8846],"./polyhedra/KeplerPoinsot/Great_stellated_dodecahedron.off":[4878,4878],"./polyhedra/KeplerPoinsot/Small_stellated_dodecahedron.off":[9983,9983],"./polyhedra/Platonic/Cube.off":[9545,9545],"./polyhedra/Platonic/Dodecahedron.off":[8352,8352],"./polyhedra/Platonic/Icosahedron.off":[6047,6047],"./polyhedra/Platonic/Octahedron.off":[5013,5013],"./polyhedra/Platonic/Tetrahedron.off":[7916,7916],"./polyhedra/Special/Császár_Polyhedron.off":[1959,1959],"./polyhedra/Special/Szilassi_Polyhedron.off":[9940,9940]};function r(e){if(!o.o(i,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],r=t[0];return o.e(t[1]).then((function(){return o.t(r,17)}))}r.keys=function(){return Object.keys(i)},r.id=7074,e.exports=r},7327:function(e,t,o){"use strict";var i=o(4922),r=o(9437),n=o(9875),a=o(382),s=o(7024),c=o(8735),l=o.n(c),h=o(1291),d=o.n(h),f=o(1112),u=o.n(f),p=o(6898),g=o(6363),m=o(9999),b=o(1419),y=o(9476),v=o(4264),w=o(4385);var S="\nvec3 schlegelProjection(vec4 point4D) {\n  if (isOrtho) return point4D.xyz;\n  return projectionDistance * point4D.xyz / (projectionDistance - point4D.w);\n}\n",_="\nvec3 transformCylinderPoint(vec3 point, vec3 v1, vec3 v2) {\n    // Compute direction and length\n    vec3 d = v2 - v1;\n    float d_length = length(d);\n    \n    vec3 d_ = d;\n    d_.y = 0.0;\n    if (length(d_) < 1e-6) {\n      vec3 scaled_point = point * vec3(1.0, d_length, 1.0);\n      if (v2.y > v1.y) return scaled_point + v1;\n      if (v2.y < v1.y) return scaled_point + v2;\n    }\n    \n    // If v1 and v2 are too close, return v1 (or discard)\n    if (d_length < 1e-6) {\n        return v1; // Or handle as error\n    }\n    vec3 d_normalized = d / d_length;\n\n    // Step 1: Scale along y-axis\n    vec3 scaled_point = point * vec3(1.0, d_length, 1.0);\n\n    // Step 2: Rotate y-axis to d_normalized\n    vec3 y_axis = vec3(0.0, 1.0, 0.0);\n    float dot_product = dot(y_axis, d_normalized);\n    \n    // Handle parallel cases (dot_product ≈ ±1)\n    if (abs(dot_product) > 0.99999) {\n        if (dot_product < 0.0) {\n            // Opposite direction: rotate 180° around x-axis\n            scaled_point.y = -scaled_point.y; // Equivalent to 180° rotation\n        }\n        // Else: same direction, no rotation needed\n    } else {\n        // General case: compute rotation axis and angle\n        vec3 rotation_axis = normalize(cross(d_normalized, y_axis));\n        float rotation_angle = acos(clamp(dot_product, -1.0, 1.0));\n        \n        // Rodrigues' rotation formula\n        float cos_angle = cos(rotation_angle);\n        float sin_angle = sin(rotation_angle);\n        \n        mat3 K = mat3(\n            0.0, -rotation_axis.z, rotation_axis.y,\n            rotation_axis.z, 0.0, -rotation_axis.x,\n            -rotation_axis.y, rotation_axis.x, 0.0\n        );\n        mat3 R = mat3(1.0) + sin_angle * K + (1.0 - cos_angle) * (K * K);\n        scaled_point = R * scaled_point;\n    }\n\n    // Step 3: Translate to v1\n    return scaled_point + v1;\n}\n";var x={sphereMaterial3D:function(e,t,o,i){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.radius=t,e.uniforms.rotation4D=o,e.uniforms.offset3D=i,e.vertexShader=`\n      attribute vec3 pos;\n      uniform float radius;\n      uniform mat4 rotation4D;\n      uniform vec3 offset3D;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 顶点按 radius 统一缩放\n      transformed *= radius;\n      transformed += (rotation4D * vec4(pos, 0)).xyz;\n      transformed += offset3D;\n      ")},e},cylinderMaterial3D:function(e,t,o,i){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.radius=t,e.uniforms.rotation4D=o,e.uniforms.offset3D=i,e.vertexShader=`\n      attribute vec3 v1;\n      attribute vec3 v2;\n      uniform float radius;\n      uniform mat4 rotation4D;\n      uniform vec3 offset3D;\n      ${_}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <defaultnormal_vertex>","\n      #include <defaultnormal_vertex>\n      // 计算法向量。\n      vec3 transformedV1 = (rotation4D * vec4(v1, 0)).xyz;\n      vec3 transformedV2 = (rotation4D * vec4(v2, 0)).xyz;\n      \n      objectNormal = transformCylinderPoint(objectNormal, transformedV1, transformedV2);\n      transformedNormal = normalMatrix * objectNormal;\n      ").replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 让圆柱变粗/细。\n      transformed.x *= radius;\n      transformed.z *= radius;\n      transformed.y += 0.5;\n      transformed = transformCylinderPoint(transformed, transformedV1, transformedV2);\n      transformed += offset3D;\n      ")},e},faceMaterial3D:function(e,t,o){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.rotation4D=t,e.uniforms.offset3D=o,e.vertexShader=`\n      uniform mat4 rotation4D;\n      uniform vec3 offset3D;\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 将位置旋转。\n      transformed = (rotation4D * vec4(transformed, 0)).xyz;\n      transformed += offset3D;\n      ")},e},sphereMaterial:function(e,t,o,i,r,n,a){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.projectionDistance=n,e.uniforms.rotation4D=o,e.uniforms.offset4D=i,e.uniforms.offset3D=r,e.uniforms.radius=t,e.uniforms.isOrtho=a,e.vertexShader=`\n      attribute vec4 center4D;\n      uniform float radius;\n      uniform float projectionDistance;\n      uniform bool isOrtho;\n      uniform mat4 rotation4D;\n      uniform vec4 offset4D;\n      uniform vec3 offset3D;\n\n      ${S}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 将顶点按球体半径缩放，再加上中心点的 3D 投影\n      vec3 center3D = schlegelProjection(rotation4D * center4D + offset4D);\n      float radius_scale = length(center3D) / length(center4D);\n      transformed = transformed * radius * radius_scale + center3D + offset3D;\n      ")},e},cylinderMaterial:function(e,t,o,i,r,n,a){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.projectionDistance=n,e.uniforms.rotation4D=o,e.uniforms.offset4D=i,e.uniforms.offset3D=r,e.uniforms.radius=t,e.uniforms.isOrtho=a,e.vertexShader=`\n      attribute vec4 v1;\n      attribute vec4 v2;\n      uniform float radius;\n      uniform float projectionDistance;\n      uniform bool isOrtho;\n      uniform mat4 rotation4D;\n      uniform vec4 offset4D;\n      uniform vec3 offset3D;\n      \n      ${S}\n      ${_}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <defaultnormal_vertex>","\n      #include <defaultnormal_vertex>\n      // 计算 4D 空间中圆柱两端点的投影\n      vec3 pv1 = schlegelProjection(rotation4D * v1 + offset4D);\n      vec3 pv2 = schlegelProjection(rotation4D * v2 + offset4D);\n      // 计算法向量\n      objectNormal = transformCylinderPoint(objectNormal, pv1, pv2);\n      transformedNormal = normalMatrix * objectNormal;\n      ").replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      float v1_radius_scale = length(pv1) / length(v1);\n      float v2_radius_scale = length(pv2) / length(v2);\n\n      transformed.y += 0.5;\n      // 判断顶点在哪一头\n      vec3 transformed_simulation = transformCylinderPoint(transformed, pv1, pv2);\n      \n      vec3 diff1 = transformed_simulation - pv1;\n      vec3 diff2 = transformed_simulation - pv2;\n      \n      bool closerToPv1 = dot(diff1, diff1) < dot(diff2, diff2);\n      \n      // 缩放成锥台\n      float radius_scale = closerToPv1 ? v1_radius_scale : v2_radius_scale;\n      transformed.x *= radius * radius_scale;\n      transformed.z *= radius * radius_scale;\n      transformed = transformCylinderPoint(transformed, pv1, pv2) + offset3D;\n      ")},e},faceMaterial:function(e,t,o,i,r,n){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.projectionDistance=r,e.uniforms.rotation4D=t,e.uniforms.offset4D=o,e.uniforms.offset3D=i,e.uniforms.isOrtho=n,e.vertexShader=`\n      attribute vec4 position4D;\n      uniform float projectionDistance;\n      uniform bool isOrtho;\n      uniform mat4 rotation4D;\n      uniform vec4 offset4D;\n      uniform vec3 offset3D;\n      \n      ${S}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 将四维位置旋转后投影到三维空间\n      vec4 rotatedPosition4D = rotation4D * position4D + offset4D;\n      transformed = schlegelProjection(rotatedPosition4D) + offset3D;\n      ")},e},axisMaterial:function(e,t,o,i,r){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.rotation4D=t,e.uniforms.offset4D=o,e.uniforms.offset3D=i,e.uniforms.offsetScale=r,e.vertexShader=`\n      attribute uint axis;\n      attribute float len;\n      uniform mat4 rotation4D;\n      uniform vec4 offset4D;\n      uniform vec3 offset3D;\n      uniform float offsetScale;\n      \n      ${_}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 根据 axis 决定投影到四维哪条轴上\n      vec4 v = vec4(0.0);\n      if (axis == 0u) v.x = 1.0;\n      else if (axis == 1u) v.y = 1.0;\n      else if (axis == 2u) v.z = 1.0;\n      else if (axis == 3u) v.w = 1.0;\n      // 投影并计算缩放，使圆柱长度符合 len\n      vec3 vProj = (rotation4D * v).xyz;\n      float s = length(vProj) / length(v);\n      float scale = len / length(vProj) * s;\n      vProj *= scale;\n      // 旋转与平移\n      transformed = transformCylinderPoint(position + vec3(0.0, 0.5, 0.0), -vProj + offset4D.xyz * offsetScale, vProj + offset4D.xyz * offsetScale) + offset3D * offsetScale;\n      ")},e},axisConeMaterial:function(e,t,o,i,r){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.rotation4D=t,e.uniforms.offset4D=o,e.uniforms.offset3D=i,e.uniforms.offsetScale=r,e.vertexShader=`\n      attribute uint axis;\n      attribute float len;\n      attribute float height;\n      uniform mat4 rotation4D;\n      uniform vec4 offset4D;\n      uniform vec3 offset3D;\n      uniform float offsetScale;\n\n      ${_}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 同 axisMaterial，但是底部坐标变成了坐标轴圆柱的结束坐标。\n      vec4 v = vec4(0.0);\n      if (axis == 0u) v.x = 1.0;\n      else if (axis == 1u) v.y = 1.0;\n      else if (axis == 2u) v.z = 1.0;\n      else if (axis == 3u) v.w = 1.0;\n      vec3 vProj = (rotation4D * v).xyz;\n      float s = length(vProj) / length(v);\n      float scale1 = len / length(vProj) * s;\n      float scale2 = (len * s + height) / length(vProj);\n      vec3 vProj1 = vProj * scale1;\n      vec3 vProj2 = vProj * scale2;\n      transformed = transformCylinderPoint(position + vec3(0.0, 0.5, 0.0), vProj1 + offset4D.xyz * offsetScale, vProj2 + offset4D.xyz * offsetScale) + offset3D * offsetScale;\n      ")},e},axisLabelMaterial:function(e,t,o,i,r){return(e=e.clone()).onBeforeCompile=e=>{e.uniforms.rotation4D=t,e.uniforms.offset4D=o,e.uniforms.offset3D=i,e.uniforms.offsetScale=r,e.vertexShader=`\n      attribute uint axis;\n      attribute float len;\n      attribute float offset;\n      uniform mat4 rotation4D;\n      uniform vec4 offset4D;\n      uniform vec3 offset3D;\n      uniform float offsetScale;\n\n      ${_}\n      ${e.vertexShader}\n    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>","\n      #include <begin_vertex>\n      // 类似 axisCone，但是往坐标轴方向上偏移了一些。\n      vec4 v = vec4(0.0);\n      if (axis == 0u) v.x = 1.0;\n      else if (axis == 1u) v.y = 1.0;\n      else if (axis == 2u) v.z = 1.0;\n      else if (axis == 3u) v.w = 1.0;\n      vec3 vProj = (rotation4D * v).xyz;\n      float s = length(vProj) / length(v);\n      float scale1 = (len * s + offset) / length(vProj);\n      float scale2 = (len * s + offset + 1.0) / length(vProj);\n      vec3 vProj1 = vProj * scale1;\n      vec3 vProj2 = vProj * scale2;\n      transformed = transformCylinderPoint(position + vec3(0.0, 0.5, 0.0), vProj1 + offset4D.xyz * offsetScale, vProj2 + offset4D.xyz * offsetScale) + offset3D * offsetScale;\n      ")},e}},E=o(2543);o(2312),o(9004);function C(e){const t=e.flatMap((e=>e.map(((t,o)=>[Math.min(t,e[(o+1)%e.length]),Math.max(t,e[(o+1)%e.length])]))));return[...new Set(t.map(JSON.stringify))].map(JSON.parse)}function D(e,t){const o=Math.max(t-e+1,0);return Array.from({length:o},((t,o)=>e+o))}function P(e){return t=e.reduce(((e,t)=>{const o=t.x**2+t.y**2+t.z**2;return o>(e.dist||-1)?{point:t,dist:o}:e}),{}).point,Math.sqrt(t.x**2+t.y**2+t.z**2);var t}function M(e,t,o){e&&e.traverse((e=>{if(e.isMesh&&e.material)if(Array.isArray(e.material))for(let i of e.material)(0,E.set)(i,t,o),i.needsUpdate=!0;else(0,E.set)(e.material,t,o),e.material.needsUpdate=!0}))}function O(e){e.traverse((e=>{e.isMesh&&(e.geometry?.dispose(),e.material?.dispose())})),e.clear()}function R(e){const t=new i.LoY;return["position","normal","uv"].forEach((o=>e.attributes[o]&&t.setAttribute(o,e.attributes[o].clone()))),e.index&&t.setIndex(e.index.clone()),e.parameters&&(t.parameters={...e.parameters}),e.dispose(),t}function j(e,t,o,r,n,a){const s=i.cj9.degToRad(e),c=i.cj9.degToRad(t),l=i.cj9.degToRad(o),h=i.cj9.degToRad(r),d=i.cj9.degToRad(n),f=i.cj9.degToRad(a),u=Math.cos(s),p=Math.sin(s),g=Math.cos(c),m=Math.sin(c),b=Math.cos(l),y=Math.sin(l),v=Math.cos(h),w=Math.sin(h),S=Math.cos(d),_=Math.sin(d),x=Math.cos(f),E=Math.sin(f),C=(new i.kn4).set(u,-p,0,0,p,u,0,0,0,0,1,0,0,0,0,1),D=(new i.kn4).set(g,0,-m,0,0,1,0,0,m,0,g,0,0,0,0,1),P=(new i.kn4).set(b,0,0,-y,0,1,0,0,0,0,1,0,y,0,0,b),M=(new i.kn4).set(1,0,0,0,0,v,-w,0,0,w,v,0,0,0,0,1),O=(new i.kn4).set(1,0,0,0,0,S,0,-_,0,0,1,0,0,_,0,S),R=(new i.kn4).set(1,0,0,0,0,1,0,0,0,0,x,-E,0,0,E,x),j=new i.kn4;return j.multiply(R),j.multiply(O),j.multiply(M),j.multiply(P),j.multiply(D),j.multiply(C),j}function F(e,t=""){if("all"===e)return;if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(`${t} 必须是非数组的对象类型或为字符串 "all"。`);if(!["indices","ranges","nHedra"].some((t=>void 0!==e[t]&&(Array.isArray(e[t])||"object"==typeof e[t]&&!Array.isArray(e[t]))))&&!e.exclude)throw new Error(`${t} 必须包含至少一个有效配置项（indices/ranges/nHedra）或 exclude 配置。`);const o=(e,t="")=>{if(void 0!==e.indices){if(!Array.isArray(e.indices))throw new Error(`${t}indices 必须是数组类型。`);e.indices.forEach(((e,o)=>{if(!Number.isInteger(e)||e<0)throw new Error(`${t}indices[${o}] 必须是非负整数，当前值为 ${e}。`)}))}if(void 0!==e.ranges){if(!Array.isArray(e.ranges))throw new Error(`${t}ranges 必须是二维数组类型。`);e.ranges.forEach(((e,o)=>{if(!Array.isArray(e)||2!==e.length)throw new Error(`${t}ranges[${o}] 必须是 [start, end] 格式的数组。`);const[i,r]=e;if(!Number.isInteger(i)||i<0)throw new Error(`${t}ranges[${o}][0]（start）必须是非负整数，当前值为 ${i}。`);if(!Number.isInteger(r)||r<0)throw new Error(`${t}ranges[${o}][1]（end）必须是非负整数，当前值为 ${r}。`);if(i>r)throw new Error(`${t}ranges[${o}] 的 start 值 ${i} 不能大于 end 值 ${r}。`)}))}if(void 0!==e.nHedra){if(!Array.isArray(e.nHedra))throw new Error(`${t}nHedra 必须是数组类型。`);e.nHedra.forEach(((e,i)=>{if("number"==typeof e){if(!Number.isInteger(e)||e<=0)throw new Error(`${t}nHedra[${i}] 作为数字时必须为正整数，当前值为 ${e}。`)}else{if("object"!=typeof e||null===e)throw new Error(`${t}nHedra[${i}] 必须是数字或配置对象。`);if(!Number.isInteger(e.nFaces)||e.nFaces<=0)throw new Error(`${t}nHedra[${i}].nFaces 必须为正整数，当前值为 ${e.nFaces}。`);if(!e.ranges)throw new Error(`${t}nHedra[${i}].ranges 是必填项。`);if(!Array.isArray(e.ranges))throw new Error(`${t}nHedra[${i}].ranges 必须是二维数组类型。`);o({ranges:e.ranges},`${t}nHedra[${i}].`)}}))}};if(o(e,t),e.exclude){if("object"!=typeof e.exclude||Array.isArray(e.exclude))throw new Error("exclude 配置必须是对象类型。");o(e.exclude,t+"exclude.")}}function $(e,t){const o=new Set(t);for(let t=e.length-1;t>=0;t--)o.has(e[t])&&e.splice(t,1);return e}function I(e,t,o=Math.E,i=32){if(e<=0||t<=0)throw new Error("最小值和最大值必须大于零。");if(t<=e)throw new Error("最大值必须大于最小值。");if(i<=0)throw new Error("分段数必须大于零。");const r=Math.log(e)/Math.log(o),n=Math.log(t)/Math.log(o)-r,a={min:e,max:t};for(let e=1;e<i;e++){const t=r+e/i*n,s=Math.pow(o,t);a[(e/i*100).toFixed(3)+"%"]=s}return a}function A(e){const t=[];for(let o=0;o<e;o++){const i=o/e*Math.PI,r=(o+1)/e*Math.PI,n=Math.sin(i-Math.PI/2)/2+.5,a=Math.sin(r-Math.PI/2)/2+.5;t.push(a-n)}return t}function U(e){const t=1/e;return new Array(e).fill(t)}var B=o.p+"assets/Sarasa_Mono_SC_Bold.typeface.d371e85fa97531c29c32.json";function G(e){return new i._4j({color:e,roughness:.3,metalness:0,flatShading:!0})}function H(e,t,o,r,n,a){const s=R(new i.Ho_(.5,.5,1,10)),c=s.attributes.position.count,l=new Uint32Array(c),h=new Float32Array(c);for(let t=0;t<c;t++)l[t]=e,h[t]=50;s.setAttribute("axis",new i.MW4(l,1)),s.setAttribute("len",new i.qtW(h,1));let d=G(t);d=x.axisMaterial(d,o,r,n,a);return new i.eaF(s,d)}function J(e,t,o,r,n,a){const s=R(new i.qFE(2,1,10)),c=s.attributes.position.count,l=new Uint32Array(c),h=new Float32Array(c),d=new Float32Array(c);for(let t=0;t<c;t++)l[t]=e,h[t]=50,d[t]=6;s.setAttribute("axis",new i.MW4(l,1)),s.setAttribute("len",new i.qtW(h,1)),s.setAttribute("height",new i.qtW(d,1));let f=G(t);f=x.axisConeMaterial(f,o,r,n,a);return new i.eaF(s,f)}function k(e,t,o,r,n,a,s,c){const l=R(new w._(o,{font:r,size:5,depth:1,curveSegments:12}));l.computeBoundingBox(),l.center();const h=l.attributes.position.count,d=new Uint32Array(h),f=new Float32Array(h),u=new Float32Array(h);for(let t=0;t<h;t++)d[t]=e,f[t]=50,u[t]=13;l.setAttribute("axis",new i.MW4(d,1)),l.setAttribute("len",new i.qtW(f,1)),l.setAttribute("offset",new i.qtW(u,1));let p=G(t);p=x.axisLabelMaterial(p,n,a,s,c);return new i.eaF(l,p)}var T=async function(e,t,o,r,n){const a=await(s=B,new Promise(((e,t)=>{(new v.J).load(s,(t=>e(t)),void 0,(e=>t(e)))})));var s;const c=new i.YJl,l=H(0,16711680,t,o,r,n),h=J(0,16711680,t,o,r,n),d=k(0,16711680,"X",a,t,o,r,n),f=H(1,65280,t,o,r,n),u=J(1,65280,t,o,r,n),p=k(1,65280,"Y",a,t,o,r,n),g=H(2,255,t,o,r,n),m=J(2,255,t,o,r,n),b=k(2,255,"Z",a,t,o,r,n),y=H(3,15757350,t,o,r,n),w=J(3,15757350,t,o,r,n),S=k(3,15757350,"W",a,t,o,r,n);return c.add(l,h,d),c.add(f,u,p),c.add(g,m,b),c.add(y,w,S),e.add(c),c},z=o(5565),V=o.n(z);const N=(e,t)=>0===t?e:N(t,e%t);function*L(e,t){let o=0;const i=N(e,t);for(let r=0;r<e;r++)r%(e/i)==0&&0!==r&&o++,yield o,o+=t,o%=e}function q(e,t=1){const o=N(e,t),i=e%2==0?1*Math.PI/e:0,r=2*Math.sin(Math.PI*t/e),n=[];for(const o of[1,-1])for(const a of L(e,t)){const t=2*Math.PI*a/e+i,s=Math.cos(t),c=Math.sin(t);n.push({x:s,y:o*r/2,z:-c})}const a=[];for(let t=0;t<o;t++)for(let i=e/o*t;i<e/o*(t+1);i++){const r=i,n=(i+1)%(e/o*(t+1)),s=n+e,c=r+e;a.push([r,n+(0===n?e/o*t:0),s+(s===e?e/o*t:0),c])}a.push(...(0,E.chunk)(D(0,2*e-1),e/o));const s=C(a).map((e=>e.map((e=>n[e]))));return{vertices:n,faces:a,edges:s}}function W(e,t=1){const o={neverRegular:!1,data:null},i=N(e,t),r=e%2==0?1*Math.PI/e:0;let n=Math.sqrt(2)*Math.sqrt(Math.cos(Math.PI*t/e)-Math.cos(2*Math.PI*t/e));Number.isNaN(n)&&(n=1,o.neverRegular=!0);const a=[];for(const o of[1,-1])for(const i of L(e,t)){const s=2*Math.PI*i/e+r+(-1===o?Math.PI*t/e:0),c=Math.cos(s),l=Math.sin(s);a.push({x:c,y:o*n/2,z:-l})}const s=[];s.push(...(0,E.chunk)(D(0,2*e-1),e/i));for(let t=0;t<i;t++)for(let o=e/i*t;o<e/i*(t+1);o++){const r=o;let n=(o+1)%(e/i*(t+1));const a=r+e;n+=0===n?e/i*t:0,s.push([r,n,a]),s.push([a,n+e,n])}const c=C(s).map((e=>e.map((e=>a[e]))));return o.data={vertices:a,faces:s,edges:c},o}var Y={prism:q,antiprism:W,trapezohedron:function(e,t=1){const o=N(e,t);let i=Math.sqrt(2)*Math.sqrt(Math.cos(Math.PI*t/e)-Math.cos(2*Math.PI*t/e));Number.isNaN(i)&&(i=1);const r=-i*(Math.cos(Math.PI*t/e)+1)/(2*Math.cos(Math.PI*t/e)-2),n=[{x:0,y:r,z:0},{x:0,y:-r,z:0}];for(const o of L(e,t))for(const r of[1,-1]){const a=2*Math.PI*o/e+(-1===r?Math.PI*t/e:0),s=Math.cos(a),c=Math.sin(a);n.push({x:s,y:r*i/2,z:-c})}const a=[],s=e/o;for(let e=0;e<o;e++)for(let t=s*e;t<s*(e+1);t++){const o=2*t,i=o+1,r=(o%(2*s)+2)%(2*s)+2*s*e,n=(o%(2*s)+3)%(2*s)+2*s*e;a.push([0,o+2,i+2,r+2]),a.push([1,i+2,r+2,n+2])}n.forEach((e=>e.y/=2));const c=C(a).map((e=>e.map((e=>n[e]))));return{vertices:n,faces:a,edges:c}},stephanoid:function(e,t,o){const i=(V()(t-o)?W(e).data:q(e)).vertices;t>o&&([t,o]=[o,t],i.forEach((e=>e.y=-e.y)));const r=[];if(V()(t-o))for(let i=0;i<e;i++)r.push([i,e+i,(o+i)%e,(t+i)%e+e]),r.push([i,((i-1)%e+e)%e+e,(t+i)%e,(o+i-1)%e+e]);else for(let i=0;i<e;i++)r.push([i,(i+1)%e+e,(o+i)%e,(t+i+1)%e+e]),r.push([i,((i-1)%e+e)%e+e,(t+i)%e,(o+i-1)%e+e]);const n=C(r).map((e=>e.map((e=>i[e]))));return{vertices:i,faces:r,edges:n}},duoprism:function(e,t,o=1,i=1){const r=2*Math.sin(Math.PI*o/e)/(2*Math.sin(Math.PI*i/t)),n=e%2==0?1*Math.PI/e:0,a=Math.PI/2-Math.PI/t,s=N(e,o),c=N(t,i),l=[],h=[],d=[];if(1!==s||1!==c)throw new Error("不支持复合双角柱。");{for(const s of L(e,o)){const o=2*Math.PI*s/e+n,c=Math.cos(o),h=Math.sin(o);for(const e of L(t,i)){const o=2*Math.PI*e/t+a,i=Math.cos(o)*r,n=Math.sin(o)*r;l.push({x:c,y:i,z:-h,w:n})}}const s=[];for(let o=0;o<e;o++)for(let i=0;i<t;i++){const r=(o+1)%e,n=(i+1)%t,a=o*t+i,c=o*t+n,l=r*t+n,h=r*t+i;s.push([a,c,l,h])}const c=[];for(let o=0;o<t;o++){const i=[];for(let r=0;r<e;r++)i.push(r*t+o);c.push(i)}const f=[];for(let o=0;o<e;o++){const e=[];for(let i=0;i<t;i++)e.push(o*t+i);f.push(e)}h.push(...s),h.push(...c),h.push(...f);for(let o=0;o<t;o++){const i=[];for(let r=0;r<e;r++){const e=r*t+o;i.push(e)}i.push(s.length+o),i.push(s.length+(o+1)%t),d.push(i)}for(let o=0;o<e;o++){const i=[];for(let e=0;e<t;e++){const r=o*t+e;i.push(r)}i.push(s.length+t+o),i.push(s.length+t+(o+1)%e),d.push(i)}}const f=C(h).map((e=>e.map((e=>l[e]))));return{vertices:l,faces:h,edges:f,cells:d}}};window.WebMWriter=u(),window.download=function(e,t,o){const i=new Blob([e],{type:o}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=t,n.click()};new class{constructor(){this.canvas=null,this.faceVisibleSwitcher=null,this.wireframeVisibleSwitcher=null,this.verticesVisibleSwitcher=null,this.axisVisibleSwitcher=null,this.perspSwitcher=null,this.schleSwitcher=null,this.scaleFactorSlider=null,this.faceOpacitySlider=null,this.wireframeAndVerticesDimSlider=null,this.projectionDistanceSlider=null,this.fileInput=null,this.uploadOffBtn=null,this.infoDis=null,this.progCon=null,this.progDis=null,this.nanobar=null,this.startRecordBtn=null,this.stopRecordBtn=null,this.configFileInput=null,this.highlightCellsBtn=null,this.highlightFacesBtn=null,this.rotationSliders=[],this.errorModal=null,this.errorMsg=null,this.offSeleEle=null,this.polyhedraSeleEle=null,this.polychoraSeleEle=null,this.genPrismBtn=null,this.prismNInput=null,this.genAntiprismBtn=null,this.antiprismNInput=null,this.genTrapezohedronBtn=null,this.trapezohedronNInput=null,this.genStephanoidBtn=null,this.stephanoidNInput=null,this.stephanoidAInput=null,this.stephanoidBInput=null,this.genDuoprismBtn=null,this.duoprismMInput=null,this.duoprismNInput=null,this.axesGroup=null,this.solidGroup=null,this.facesGroup=null,this.wireframeGroup=null,this.verticesGroup=null,this.rotAngles=[0,0,0,0,0,0],this.rotUni={value:new i.kn4},this.ofsUni={value:new i.IUQ(0,0,0,0)},this.ofs3Uni={value:new i.Pq0},this.axesOffsetScaleUni={value:1},this.projDistUni={value:2},this.isOrthoUni={value:0},this.cylinderRadiusUni={value:.5},this.sphereRadiusUni={value:1},this.renderer=null,this.isRenderingFlag=!1,this.scene=null,this.camera=null,this.controls=null,this.capturer=null,this.recordConfig=null,this.recordStates=null,this.isRecordingFlag=!1,this.stopRecordFlag=!1,this.cells=[],this.faces=[],this.facesMap={},this.nHedraInCells={},this.ngonsInFaces={},this.highlightedPartGroup=new i.YJl,this.loadMeshPromise=null,this.is4D=!1,this.scaleFactor=1,this.initialMaterial=new i._4j({color:5592405,roughness:.7,metalness:.1,flatShading:!0,emissive:0}),this.editor=null,this.errorModalBs=null,this.init()}async importOff(e){try{return(await o(7074)(`./${e}`)).default}catch(e){return console.error("OFF 加载失败：",e),{}}}async init(){this._initializeDomElements(),this._initializeSliders(),this._initializeRenderer(),this._initializeScene(),this._initializeCameras(),this._initializeLights(),this._initializeControls(),this._initializeEditor(),document.querySelectorAll("a[data-path]").forEach((e=>{e.classList.add("list-group-item"),e.classList.add("list-group-item-action")})),this.errorModalBs=new n.aF(this.errorModal),this.axesGroup=await T(this.scene,this.rotUni,this.ofsUni,this.ofs3Uni,this.axesOffsetScaleUni),await this.loadMeshFromUrl(await this.importOff("polyhedra/KeplerPoinsot/Small_stellated_dodecahedron.off"),this.initialMaterial),this.setupEventListeners(),this.startRenderLoop()}_initializeDomElements(){this.canvas=document.getElementById("polytopeRenderer"),this.faceVisibleSwitcher=document.getElementById("faceVisibleSwitcher"),this.wireframeVisibleSwitcher=document.getElementById("wireframeVisibleSwitcher"),this.verticesVisibleSwitcher=document.getElementById("verticesVisibleSwitcher"),this.axisVisibleSwitcher=document.getElementById("axisVisibleSwitcher"),this.perspSwitcher=document.getElementById("perspSwitcher"),this.schleSwitcher=document.getElementById("schleSwitcher"),this.scaleFactorSlider=document.getElementById("scaleFactorSlider"),this.faceOpacitySlider=document.getElementById("faceOpacitySlider"),this.wireframeAndVerticesDimSlider=document.getElementById("wireframeAndVerticesDimSlider"),this.projectionDistanceSlider=document.getElementById("projectionDistanceSlider"),this.fileInput=document.getElementById("fileInput"),this.uploadOffBtn=document.getElementById("uploadOff"),this.infoDis=document.getElementById("info"),this.progCon=document.getElementById("progContainer"),this.progDis=document.getElementById("prog"),this.startRecordBtn=document.getElementById("startRecord"),this.stopRecordBtn=document.getElementById("stopRecord"),this.configFileInput=document.getElementById("configFileInput"),this.highlightCellsBtn=document.getElementById("highlightCells"),this.highlightFacesBtn=document.getElementById("highlightFaces"),this.errorModal=document.getElementById("errorModal"),this.errorMsg=document.getElementById("errorMsg"),this.offSeleEle=document.getElementById("offSele"),this.polyhedraSeleEle=document.getElementById("polyhedra"),this.polychoraSeleEle=document.getElementById("polychora"),this.genPrismBtn=document.getElementById("genPrism"),this.prismNInput=document.getElementById("prismN"),this.genAntiprismBtn=document.getElementById("genAntiprism"),this.antiprismNInput=document.getElementById("antiprismN"),this.genTrapezohedronBtn=document.getElementById("genTrapezohedron"),this.trapezohedronNInput=document.getElementById("trapezohedronN"),this.genStephanoidBtn=document.getElementById("genStephanoid"),this.stephanoidNInput=document.getElementById("stephanoidN"),this.stephanoidAInput=document.getElementById("stephanoidA"),this.stephanoidBInput=document.getElementById("stephanoidB"),this.genDuoprismBtn=document.getElementById("genDuoprism"),this.duoprismMInput=document.getElementById("duoprismM"),this.duoprismNInput=document.getElementById("duoprismN"),this.rotationSliders=["XY","XZ","XW","YZ","YW","ZW"].map((e=>document.getElementById(`rot${e}Slider`)))}_initializeSliders(){y.Ay.create(this.scaleFactorSlider,{range:I(.1,120),start:1,tooltips:!0,connect:[!0,!1]}),y.Ay.create(this.faceOpacitySlider,{range:{min:.1,max:1},start:1,tooltips:!0,connect:[!0,!1]}),y.Ay.create(this.wireframeAndVerticesDimSlider,{range:I(.01,3),start:.5,tooltips:!0,connect:[!0,!1]}),y.Ay.create(this.projectionDistanceSlider,{range:I(.01,100),start:1,tooltips:!0,connect:[!0,!1]}),this.rotationSliders.forEach((e=>{y.Ay.create(e,{range:{min:0,max:360},start:0,tooltips:{to:function(e){return e.toFixed(2)+"°"}},connect:[!0,!1]})}))}_initializeRenderer(){const e=window.devicePixelRatio||1;this.renderer=new r.JeP({antialias:!0,powerPreference:"high-performance",canvas:this.canvas});const t=Math.min(Math.min(window.innerWidth,window.innerHeight),720);this.renderer.setSize(t*e,t*e,!1),this.canvas.style.width=`${t}px`,this.canvas.style.height=`${t}px`,this.progCon.style.left=t/2+8+"px",this.progCon.style.top=t/2+8+"px",this.nanobar&&(this.nanobar.style.width=.7*t+"px"),window.addEventListener("resize",(()=>{const t=Math.min(Math.min(window.innerWidth,window.innerHeight),720);this.renderer.setSize(t*e,t*e,!1),this.canvas.style.width=`${t}px`,this.canvas.style.height=`${t}px`,this.progCon.style.left=t/2+8+"px",this.progCon.style.top=t/2+8+"px",this.nanobar&&(this.nanobar.style.width=.7*t+"px")}))}_initializeScene(){this.scene=new i.Z58,this.scene.background=new i.Q1f(1118481)}_initializeCameras(){this.camera=new i.ubm(60,1,.01,500),this.camera.position.set(0,0,120)}_initializeLights(){const e=new i.$p8(16777215,6);this.scene.add(e);const t=new i.dth(8965375,16755302,8);this.scene.add(t);const o=new i.ZyN(16777215,10);o.position.set(2,3,2),this.scene.add(o);const r=new i.HiM(16772829,8);r.position.set(-2,1,2),this.scene.add(r);const n=new i.HiM(16777215,7);n.position.set(1,-1,-2),this.scene.add(n)}_initializeControls(){this.controls=new s.N(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.8,this.controls.enablePan=!1,this.controls.minDistance=1,this.controls.maxDistance=150,this.controls.minZoom=.7,this.controls.maxZoom=175}_initializeEditor(){this.editor=new p.Lz({doc:"555555FF: all",extensions:[g.oQ,(0,m.oQ)(),(0,b.bu)((e=>{try{a.Ay.load(e.state.doc.toString())}catch(e){return[{from:e.mark.position-1,message:e.reason,severity:"error",to:e.mark.position-1}]}return[]}))],parent:document.querySelector("#editor")})}render(){this.controls.update(),this.renderer.render(this.scene,this.camera)}renderLoop(){this.isRenderingFlag&&(this.render(),requestAnimationFrame(this.renderLoop.bind(this)))}startRenderLoop(){this.isRenderingFlag||(this.isRenderingFlag=!0,this.renderLoop())}stopRenderLoop(){this.isRenderingFlag&&(this.isRenderingFlag=!1)}triggerErrorDialog(e){this.errorMsg.innerHTML=e,this.errorModalBs.show()}createWireframeAndVertices(e,{cylinderMaterial:t,sphereMaterial:o,cylinderColor:r=7829367,sphereColor:n=16766720}={}){let a=t||new i._4j({color:r,metalness:.9,roughness:.3}),s=o||new i._4j({color:n,metalness:1,roughness:.3});a=x.cylinderMaterial3D(a,this.cylinderRadiusUni,this.rotUni,this.ofs3Uni),s=x.sphereMaterial3D(s,this.sphereRadiusUni,this.rotUni,this.ofs3Uni);const c=R(new i.Ho_(1,1,1,16)),l=new i.ZLX(c,a,e.length),h=new Float32Array(3*e.length),d=new Float32Array(3*e.length),f=R(new i.Gu$(1,16,16)),u=new i.ZLX(f,s,2*e.length);u.count=0;const p=[],g=new Set;e.forEach((([e,t],o)=>{const r=`${e.x},${e.y},${e.z}`,n=`${t.x},${t.y},${t.z}`,a=new i.Pq0(e.x,e.y,e.z),s=new i.Pq0(t.x,t.y,t.z);h.set(a.toArray(),3*o),d.set(s.toArray(),3*o),g.has(r)||(p.push(...a.toArray()),u.count++,g.add(r)),g.has(n)||(p.push(...s.toArray()),u.count++,g.add(n))})),l.instanceMatrix.needsUpdate=!0,u.instanceMatrix.needsUpdate=!0,c.setAttribute("v1",new i.uWO(h,3)),c.setAttribute("v2",new i.uWO(d,3)),f.setAttribute("pos",new i.uWO(new Float32Array(p),3));const m=new i.YJl,b=new i.YJl;return m.add(l),b.add(u),{wireframeGroup:m,verticesGroup:b}}create4DWireframeAndVertices(e,{cylinderMaterial:t,sphereMaterial:o,cylinderColor:r=7829367,sphereColor:n=16766720}={}){let a=t||new i._4j({color:r,metalness:.9,roughness:.3}),s=o||new i._4j({color:n,metalness:1,roughness:.3});a=x.cylinderMaterial(a,this.cylinderRadiusUni,this.rotUni,this.ofsUni,this.ofs3Uni,this.projDistUni,this.isOrthoUni),s=x.sphereMaterial(s,this.sphereRadiusUni,this.rotUni,this.ofsUni,this.ofs3Uni,this.projDistUni,this.isOrthoUni);const c=new i.YJl,l=new i.YJl,h=new Set,d=new Float32Array(4*e.length),f=new Float32Array(4*e.length),u=[];e.forEach((([e,t],o)=>{const i=`${e.x},${e.y},${e.z},${e.w}`,r=`${t.x},${t.y},${t.z},${t.w}`;d.set(Object.values(e),4*o),f.set(Object.values(t),4*o),h.has(i)||(u.push(Object.values(e)),h.add(i)),h.has(r)||(u.push(Object.values(t)),h.add(r))}));const p=R(new i.Ho_(1,1,1,16));p.setAttribute("v1",new i.uWO(d,4)),p.setAttribute("v2",new i.uWO(f,4));const g=new i.ZLX(p,a,e.length);c.add(g);const m=R(new i.Gu$(1,16,16));m.setAttribute("center4D",new i.uWO(new Float32Array(u.flat()),4));const b=new i.ZLX(m,s,u.length);return l.add(b),{wireframeGroup:c,verticesGroup:l}}loadMesh(e,t){this.is4D=!1,this.cells=[],this.faces=e.faces,this.facesMap=e.facesMap,this.nHedraInCells={},this.ngonsInFaces={},this.highlightedPartGroup.clear(),this.ngonsInFaces=e.ngonsInFaces,this.solidGroup&&(O(this.solidGroup),this.scene.remove(this.solidGroup)),this.updateEnable();const o=new i.B69,r=new i.LoY,n=new Float32Array(3*e.vertices.length);e.vertices.forEach(((e,t)=>{n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z})),r.setAttribute("position",new i.THS(n,3));const a=[];e.faces.forEach((e=>a.push(...e))),r.setIndex(a),r.computeVertexNormals(),(t=x.faceMaterial3D(t,this.rotUni,this.ofs3Uni)).side=i.$EB;const s=new i.eaF(r,t);this.updateScaleFactor(40/P(e.vertices));const{wireframeGroup:c,verticesGroup:l}=this.createWireframeAndVertices(e.edges);return o.add(s),o.add(c),o.add(l),o.scale.setScalar(this.scaleFactor),o.add(this.highlightedPartGroup),this.scene.add(o),{scaleFactor:this.scaleFactor,solidGroup:o,facesGroup:s,wireframeGroup:c,verticesGroup:l}}load4DMesh(e,t){this.is4D=!0,this.cells=e.cells,this.faces=e.faces,this.facesMap=e.facesMap,this.ngonsInFaces={},this.nHedraInCells={},this.highlightedPartGroup.clear(),e.cells.forEach(((e,t)=>{Object.hasOwnProperty.call(this.nHedraInCells,e.facesCount)?this.nHedraInCells[e.facesCount].push(t):this.nHedraInCells[e.facesCount]=[t]})),this.solidGroup&&(O(this.solidGroup),this.scene.remove(this.solidGroup)),this.highlightedPartGroup.clear(),this.updateEnable();const o=new i.YJl,r=new i.LoY,n=new Float32Array(3*e.vertices.length);e.vertices.forEach(((e,t)=>{n[3*t]=e.x,n[3*t+1]=e.y,n[3*t+2]=e.z})),r.setAttribute("position",new i.THS(n,3));const a=new Float32Array(4*e.vertices.length);e.vertices.forEach(((e,t)=>{a[4*t]=e.x,a[4*t+1]=e.y,a[4*t+2]=e.z,a[4*t+3]=e.w})),r.setAttribute("position4D",new i.THS(a,4));const s=[];e.faces.forEach((e=>s.push(...e))),r.setIndex(s),r.computeVertexNormals(),(t=x.faceMaterial(t,this.rotUni,this.ofsUni,this.ofs3Uni,this.projDistUni,this.isOrthoUni)).side=i.$EB;const c=new i.eaF(r,t);var l,h;this.projectionDistanceSlider.noUiSlider.set(1.05*(l=e.vertices,h=l.reduce(((e,t)=>{const o=t.x**2+t.y**2+t.z**2+t.w**2;return o>(e.dist||-1)?{point:t,dist:o}:e}),{}).point,Math.sqrt(h.x**2+h.y**2+h.z**2+h.w**2))),this.updateProjectionDistance(),this.updateScaleFactor(40/P(e.vertices.map((e=>{if(!this.schleSwitcher.checked)return{x:e.x,y:e.y,z:e.z};const t=this.projectionDistanceSlider.noUiSlider.get(!0),o=t/(t+e.w);return{x:e.x*o,y:e.y*o,z:e.z*o}}))));const{wireframeGroup:d,verticesGroup:f}=this.create4DWireframeAndVertices(e.edges);return o.add(c),o.add(d),o.add(f),o.scale.setScalar(this.scaleFactor),o.add(this.highlightedPartGroup),this.scene.add(o),{scaleFactor:this.scaleFactor,solidGroup:o,facesGroup:c,wireframeGroup:d,verticesGroup:f}}processMeshData(e,t=!1){const i=new(l())({target:this.progCon}),r=new AbortController,n=new Worker(new URL(o.p+o.u(3233),o.b));this.nanobar=i.el,i.el.style.position="static";return{promise:new Promise(((o,r)=>{n.postMessage({meshData:e,is4D:t}),n.addEventListener("message",(e=>{const{type:t,data:a}=e.data;switch(t){case"progress":this.progDis.innerHTML=`${a.progress.toFixed(2)}%<br />（${a.current}/${a.total}）`,i.go(a.progress);break;case"complete":n.terminate(),this.progDis.innerText="",i.el.remove(),this.loadMeshPromise=null,this.nanobar=null,o(a);break;case"error":n.terminate(),this.progDis.innerText="",i.el.remove(),this.loadMeshPromise=null,this.nanobar=null,r(a)}}))})),abort:()=>{r.abort(),n.terminate(),this.progDis.innerText="",i.el.remove(),this.loadMeshPromise=null,this.nanobar=null}}}async loadMeshFromData(e,t){this.loadMeshPromise&&this.loadMeshPromise.abort();const o=e instanceof Object?e:function(e){const t=e.split("\n").filter((e=>""!==e.trim()&&!e.startsWith("#")));if("OFF"!==t[0].trim())throw new Error("不是有效的 OFF 文件。");const[o,i]=t[1].trim().split(/\s+/).map(Number),r=[];for(let e=0;e<o;e++){const[o,i,n]=t[e+2].trim().split(/\s+/).map(parseFloat);r.push({x:o,y:i,z:n})}const n=[];for(let e=0;e<i;e++){const i=t[e+2+o].trim().split(/\s+/),r=parseInt(i[0]);n.push(i.slice(1,r+1).map(Number))}const a=C(n).map((e=>e.map((e=>r[e]))));return{vertices:r,faces:n,edges:a}}(e);this.loadMeshPromise=this.processMeshData(o);const i=await this.loadMeshPromise.promise,r=`\n    顶点数：${o.vertices.length}\n    边数：${o.edges.length}\n    面数：${o.faces.length}\n    `.trim().replace(" ","");this.infoDis.innerText=r;const{scaleFactor:n,solidGroup:a,facesGroup:s,wireframeGroup:c,verticesGroup:l}=this.loadMesh(i,t);this.scaleFactor=n,this.solidGroup=a,this.facesGroup=s,this.wireframeGroup=c,this.verticesGroup=l,this.updateProperties()}async loadMeshFrom4Data(e,t){this.loadMeshPromise&&this.loadMeshPromise.abort();const o=e instanceof Object?e:function(e){const t=e.split("\n").filter((e=>""!==e.trim()&&!e.startsWith("#")));if("4OFF"!==t[0].trim())throw new Error("不是有效的 4OFF 文件。");const[o,i,,r]=t[1].trim().split(/\s+/).map(Number),n=[];for(let e=0;e<o;e++){const[o,i,r,a]=t[e+2].trim().split(/\s+/).map(parseFloat);n.push({x:o,y:i,z:r,w:a})}const a=[];for(let e=0;e<i;e++){const i=t[e+2+o].trim().split(/\s+/),r=parseInt(i[0]);a.push(i.slice(1,r+1).map(Number))}const s=[];for(let e=0;e<r;e++){const r=t[e+2+o+i].trim().split(/\s+/),n=parseInt(r[0]);s.push(r.slice(1,n+1).map(Number))}const c=C(a).map((e=>e.map((e=>n[e]))));return{vertices:n,faces:a,edges:c,cells:s}}(e);this.loadMeshPromise=this.processMeshData(o,!0);const i=await this.loadMeshPromise.promise,r=`\n    顶点数：${o.vertices.length}\n    边数：${o.edges.length}\n    面数：${o.faces.length}\n    胞数：${o.cells.length}\n    `.trim().replace(" ","");this.infoDis.innerText=r;const{scaleFactor:n,solidGroup:a,facesGroup:s,wireframeGroup:c,verticesGroup:l}=this.load4DMesh(i,t);this.scaleFactor=n,this.solidGroup=a,this.facesGroup=s,this.wireframeGroup=c,this.verticesGroup=l,this.updateProperties(),this.updateProjectionDistance(),this.updateRotation()}async loadMeshFromUrl(e,t,o=!1){return new Promise((i=>{fetch(e).then((e=>{if(!e.ok)throw new Error("网络响应不正常。");return e.text()})).then((async e=>{await(o?this.loadMeshFrom4Data.bind(this):this.loadMeshFromData.bind(this))(e,t),i()}))}))}highlightCells(e){this.highlightedPartGroup.clear();for(const[t,o]of Object.entries(e)){if(!/^[0-9a-fA-F]{8}$/.test(t))throw new Error(`十六进制 RGBA 色码 ${t} 无效。`);F(o,t+".");const e=this.facesGroup.geometry.clone(),r=x.faceMaterial(this.facesGroup.material,this.rotUni,this.ofsUni,this.ofs3Uni,this.projDistUni,this.isOrthoUni),n=parseInt(t,16),a=n>>>8,s=255&n;if(r.color.set(a),r.transparent=255!==s,r.opacity=s/255,r.visible=!0,"all"===o){const t=[];this.faces.forEach((e=>t.push(...e))),e.setIndex(t),e.computeVertexNormals(),this.highlightedPartGroup.add(new i.eaF(e,r));continue}const c=[];if(Object.hasOwnProperty.call(o,"indices")){for(const e of o.indices)if(!this.cells[e])throw new Error(`索引为 ${e} 的胞不存在。`);c.push(...o.indices)}if(Object.hasOwnProperty.call(o,"ranges"))for(const[e,t]of o.ranges.entries()){const[o,i]=t;if(!this.cells[o])throw new Error(`ranges[${e}] 的起始索引 ${o} 对应的胞不存在。`);if(!this.cells[i-1])throw new Error(`ranges[${e}] 的结束索引 ${i} 对应的胞不存在。`);c.push(...D(o,i-1))}if(Object.hasOwnProperty.call(o,"nHedra"))for(const[e,t]of o.nHedra.entries())if("number"==typeof t){const o=t;if(!this.nHedraInCells[o])throw new Error(`nHedra[${e}] 指定的 ${o} 面体胞不存在。`);c.push(...this.nHedraInCells[o])}else if(t instanceof Object){const{nFaces:o,ranges:i}=t;if(!this.nHedraInCells[o])throw new Error(`nHedra[${e}] 指定的 ${o} 面体胞不存在。`);const r=[];for(const[t,n]of i.entries()){const[i,a]=n;if(i>=this.nHedraInCells[o].length)throw new Error(`nHedra[${e}].ranges[${t}] 的起始索引 ${i} 超出范围。`);if(a>this.nHedraInCells[o].length)throw new Error(`nHedra[${e}].ranges[${t}] 的结束索引 ${a} 超出范围。`);r.push(...this.nHedraInCells[o].slice(...n))}c.push(...r)}if(Object.hasOwnProperty.call(o,"exclude")){const e=o.exclude;if(Object.hasOwnProperty.call(e,"indices")){for(const t of e.indices)if(!this.cells[t])throw new Error(`exclude.indices 中的索引 ${t} 对应的胞不存在。`);$(c,e.indices)}if(Object.hasOwnProperty.call(e,"ranges"))for(const[t,o]of e.ranges.entries()){const[e,i]=o;if(!this.cells[e])throw new Error(`exclude.ranges[${t}] 的起始索引 ${e} 对应的胞不存在。`);if(!this.cells[i-1])throw new Error(`exclude.ranges[${t}] 的结束索引 ${i} 对应的胞不存在。`);$(c,D(e,i-1))}if(Object.hasOwnProperty.call(e,"nHedra"))for(const[t,o]of e.nHedra.entries())if("number"==typeof o){const e=o;if(!this.nHedraInCells[e])throw new Error(`exclude.nHedra[${t}] 指定的 ${e} 面体胞不存在。`);$(c,this.nHedraInCells[e])}else if(o instanceof Object){const{nFaces:e,ranges:i}=o;if(!this.nHedraInCells[e])throw new Error(`exclude.nHedra[${t}] 指定的 ${e} 面体胞不存在。`);const r=[];for(const[o,n]of i.entries()){const[i,a]=n;if(i>=this.nHedraInCells[e].length)throw new Error(`exclude.nHedra[${t}].ranges[${o}] 的起始索引 ${i} 超出范围。`);if(a>this.nHedraInCells[e].length)throw new Error(`exclude.nHedra[${t}].ranges[${o}] 的结束索引 ${a} 超出范围。`);r.push(...this.nHedraInCells[e].slice(...n))}$(c,r)}}const l=[];for(const e of c)for(const t of this.cells[e].faceIndices)l.push(...this.faces[t]);e.setIndex(l),e.computeVertexNormals(),this.highlightedPartGroup.add(new i.eaF(e,r))}}highlightFaces(e){this.highlightedPartGroup.clear();for(const[t,o]of Object.entries(e)){if(!/^[0-9a-fA-F]{8}$/.test(t))throw new Error(`十六进制 RGBA 色码 ${t} 无效。`);const e=this.facesGroup.geometry.clone(),r=x.faceMaterial3D(this.facesGroup.material,this.rotUni,this.ofs3Uni),n=parseInt(t,16),a=n>>>8,s=255&n;if(r.color.set(a),r.transparent=255!==s,r.opacity=s/255,r.visible=!0,"all"===o){const t=[];this.faces.forEach((e=>t.push(...e))),e.setIndex(t),e.computeVertexNormals(),this.highlightedPartGroup.add(new i.eaF(e,r));continue}const c=[];if(Object.hasOwnProperty.call(o,"indices")){for(const e of o.indices)if(!this.facesMap[e])throw new Error(`索引为 ${e} 的面不存在。`);c.push(...o.indices)}if(Object.hasOwnProperty.call(o,"ngons")){console.log(this.ngonsInFaces);for(const e of o.ngons){if(!Object.hasOwnProperty.call(this.ngonsInFaces,e))throw new Error(`${e} 边形的面不存在。`);c.push(...this.ngonsInFaces[e])}}const l=[];for(const e of c)for(const t of this.facesMap[e])l.push(...this.faces[t]);e.setIndex(l),e.computeVertexNormals(),this.highlightedPartGroup.add(new i.eaF(e,r))}}updateProperties(){M(this.facesGroup,"visible",this.faceVisibleSwitcher.checked),M(this.wireframeGroup,"visible",this.wireframeVisibleSwitcher.checked),M(this.verticesGroup,"visible",this.verticesVisibleSwitcher.checked),M(this.axesGroup,"visible",this.axisVisibleSwitcher.checked),M(this.facesGroup,"opacity",+this.faceOpacitySlider.noUiSlider.get(!0)),M(this.facesGroup,"transparent",1!=+this.faceOpacitySlider.noUiSlider.get(!0)),this.toggleCamera(this.perspSwitcher.checked),this.cylinderRadiusUni.value=this.wireframeAndVerticesDimSlider.noUiSlider.get(!0)/this.scaleFactor,this.sphereRadiusUni.value=this.wireframeAndVerticesDimSlider.noUiSlider.get(!0)/this.scaleFactor*2,this.isOrthoUni.value=!this.schleSwitcher.checked,this.ofsUni.value=new i.IUQ(0,0,0,0),this.ofs3Uni.value=new i.Pq0}updateProjectionDistance(){this.projDistUni.value=this.projectionDistanceSlider.noUiSlider.get(!0)}updateRotation(){const e=this.rotationSliders.map((e=>e.noUiSlider.get(!0)));this.rotAngles=e,this.rotUni.value=j(...this.rotAngles)}updateScaleFactor(e,t=!0){this.scaleFactor=e,t&&this.scaleFactorSlider.noUiSlider.set(e),this.cylinderRadiusUni.value=this.wireframeAndVerticesDimSlider.noUiSlider.get(!0)/e,this.sphereRadiusUni.value=this.wireframeAndVerticesDimSlider.noUiSlider.get(!0)/e*2,this.solidGroup&&this.solidGroup.scale.setScalar(e),this.axesOffsetScaleUni.value=e}updateEnable(e=!0){if((e=>{document.querySelectorAll('input, .btn-group button:not([data-bs-toggle="tooltip"]), div[id$="Slider"], a[data-path]').forEach((t=>{"DIV"===t.tagName?t.noUiSlider[e?"enable":"disable"]():"A"===t.tagName?t.classList.toggle("disabled",!e):"INPUT"!==t.tagName&&"BUTTON"!==t.tagName||(t.disabled=!e)}))})(e),this.stopRecordBtn.disabled=!this.isRecordingFlag,!e)return;this.schleSwitcher.disabled||this.is4D||(this.rotationSliders[2].noUiSlider.set(0),this.rotationSliders[4].noUiSlider.set(0),this.rotationSliders[5].noUiSlider.set(0),this.updateRotation());const t=this.is4D?"enable":"disable";this.projectionDistanceSlider.noUiSlider[t](),this.schleSwitcher.disabled=!this.is4D,this.highlightFacesBtn.disabled=this.is4D,this.highlightCellsBtn.disabled=!this.is4D,this.rotationSliders[2].noUiSlider[t](),this.rotationSliders[4].noUiSlider[t](),this.rotationSliders[5].noUiSlider[t](),this.startRecordBtn.disabled=this.isRecordingFlag}toggleCamera(e){const t=this.camera.clone();this.camera=e?new i.ubm(60,1,.01,500):new i.qUd(-60,60,60,-60,.01,500),this.camera.position.copy(t.position),this.camera.rotation.copy(t.rotation),this._initializeControls()}setupEventListeners(){this.faceVisibleSwitcher.addEventListener("change",(()=>M(this.facesGroup,"visible",this.faceVisibleSwitcher.checked))),this.wireframeVisibleSwitcher.addEventListener("change",(()=>M(this.wireframeGroup,"visible",this.wireframeVisibleSwitcher.checked))),this.verticesVisibleSwitcher.addEventListener("change",(()=>M(this.verticesGroup,"visible",this.verticesVisibleSwitcher.checked))),this.axisVisibleSwitcher.addEventListener("change",(()=>M(this.axesGroup,"visible",this.axisVisibleSwitcher.checked))),this.scaleFactorSlider.noUiSlider.on("update",(()=>this.updateScaleFactor(this.scaleFactorSlider.noUiSlider.get(!0),!1))),this.faceOpacitySlider.noUiSlider.on("update",(()=>{M(this.facesGroup,"opacity",+this.faceOpacitySlider.noUiSlider.get(!0)),M(this.facesGroup,"transparent",1!=+this.faceOpacitySlider.noUiSlider.get(!0))})),this.wireframeAndVerticesDimSlider.noUiSlider.on("update",(()=>{this.cylinderRadiusUni.value=this.wireframeAndVerticesDimSlider.noUiSlider.get(!0)/this.scaleFactor,this.sphereRadiusUni.value=this.wireframeAndVerticesDimSlider.noUiSlider.get(!0)/this.scaleFactor*2})),this.projectionDistanceSlider.noUiSlider.on("update",this.updateProjectionDistance.bind(this)),this.rotationSliders.forEach(((e,t)=>{e.noUiSlider.on("update",(()=>{this.rotAngles[t]=e.noUiSlider.get(!0),this.rotUni.value=j(...this.rotAngles)}))})),this.perspSwitcher.addEventListener("change",(()=>this.toggleCamera(this.perspSwitcher.checked))),this.schleSwitcher.addEventListener("change",(()=>this.isOrthoUni.value=!this.schleSwitcher.checked)),this.uploadOffBtn.addEventListener("click",(()=>this.fileInput.click())),this.fileInput.addEventListener("change",this.handleFileInputChange.bind(this)),this.highlightCellsBtn.addEventListener("click",(()=>{try{const e=a.Ay.load(this.editor.state.doc.toString());this.faceVisibleSwitcher.checked=!1,this.updateProperties(),this.highlightCells(e)}catch(e){this.triggerErrorDialog(e.message),console.error(e)}})),this.highlightFacesBtn.addEventListener("click",(()=>{try{const e=a.Ay.load(this.editor.state.doc.toString());this.faceVisibleSwitcher.checked=!1,this.updateProperties(),this.highlightFaces(e)}catch(e){this.triggerErrorDialog(e.message),console.error(e)}})),this.startRecordBtn.addEventListener("click",this.startRecord.bind(this)),this.stopRecordBtn.addEventListener("click",(()=>this.stopRecordFlag=!0)),this.polyhedraSeleEle.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(async()=>{await this.loadMeshFromUrl(await this.importOff(`polyhedra/${e.dataset.path}`),this.initialMaterial)}))})),this.polychoraSeleEle.querySelectorAll("a").forEach((e=>{e.addEventListener("click",(async()=>{await this.loadMeshFromUrl(await this.importOff(`polychora/${e.dataset.path}`),this.initialMaterial,!0)}))})),this.setupSolidInfFamiliesEventListeners()}setupSolidInfFamiliesEventListeners(){const e="<math><mi>s</mi></math> 不能大于等于 <math><mi>n</mi></math>。",t="s 不能大于等于 n。";this.genPrismBtn.addEventListener("click",(async()=>{const[o,i]=this.prismNInput.value.split("/").map((e=>+e));if(i>=o)return this.triggerErrorDialog(e),void console.error(t);await this.loadMeshFromData(Y.prism(o,i),this.initialMaterial)})),this.genAntiprismBtn.addEventListener("click",(async()=>{const[o,i]=this.antiprismNInput.value.split("/").map((e=>+e));if(i>=o)return this.triggerErrorDialog(e),void console.error(t);const r=Y.antiprism(o,i);r.neverRegular&&this.triggerErrorDialog("当 <math><mi>s</mi> <mo>&ge;</mo> <mfrac><mrow><mn>2</mn><mi>n</mi></mrow><mn>3</mn></mfrac></math> 时，将无法得到正反角柱，将使用 1 作为高度。"),await this.loadMeshFromData(r.data,this.initialMaterial)})),this.genTrapezohedronBtn.addEventListener("click",(async()=>{const[o,i]=this.trapezohedronNInput.value.split("/").map((e=>+e));if(i>=o)return this.triggerErrorDialog(e),void console.error(t);await this.loadMeshFromData(Y.trapezohedron(o,i),this.initialMaterial)})),this.genStephanoidBtn.addEventListener("click",(async()=>{const e=+this.stephanoidNInput.value,t=+this.stephanoidAInput.value,o=+this.stephanoidBInput.value;if(t===o||t+o>=e)return this.triggerErrorDialog("<math><mi>a</mi> <mo>&equals;</mo> <mi>b</mn></math> 或 <math><mi>a</mi> <mo>&plus;</mo> <mi>b</mi> <mo>&ge;</mo> <mi>n</mi></math> 会生成退化的冠体。"),void console.error("a = b 或 a + b ≥ n 会生成退化的冠体。");try{await this.loadMeshFromData(Y.stephanoid(e,t,o),this.initialMaterial)}catch(e){this.triggerErrorDialog(e.message),console.error(e)}})),this.genDuoprismBtn.addEventListener("click",(async()=>{const[e,t]=this.duoprismMInput.value.split("/").map((e=>+e)),[o,i]=this.duoprismNInput.value.split("/").map((e=>+e));if(t>=e)return this.triggerErrorDialog("<math><msub><mi>s</mi><mn>1</mn></msub></math> 不能大于等于 <math><mi>m</mi></math>。"),void console.error("s1 不能大于等于 m。");if(i>=o)return this.triggerErrorDialog("<math><msub><mi>s</mi><mn>2</mn></msub></math> 不能大于等于 <math><mi>n</mi></math>。"),void console.error("s2 不能大于等于 n。");try{await this.loadMeshFrom4Data(Y.duoprism(e,o,t,i),this.initialMaterial)}catch(e){this.triggerErrorDialog(e.message),console.error(e)}}))}handleFileInputChange(e){const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void this.triggerErrorDialog("文件大小不能超过 5 MiB。");const o=new FileReader;o.onload=async t=>{const o=t.target.result;this.is4D="4OFF"===o.split("\n").filter((e=>""!==e.trim()&&!e.startsWith("#")))[0].trim();try{this.is4D?await this.loadMeshFrom4Data(o,this.initialMaterial):await this.loadMeshFromData(o,this.initialMaterial)}catch(e){this.triggerErrorDialog(e.message),console.error(e)}finally{e.target.value=""}},o.readAsText(t)}async startRecord(){try{this.recordConfig=await(e=this.configFileInput,new Promise(((t,o)=>{"file"===e.type?(e.addEventListener("change",(function i(r){if(e.removeEventListener("change",i),!e.files||0===e.files.length)return void o(new Error("没有选择文件。"));const n=e.files[0];if(n.size>5242880)return void o(new Error("文件大小不能超过 5 MiB。"));const s=new FileReader;s.onload=e=>{try{const o=a.Ay.load(e.target.result);t(o)}catch(e){o(new Error("文件解析失败: "+e.message))}finally{r.target.value=""}},s.onerror=()=>{r.target.value="",o(new Error("文件读取失败。"))},s.readAsText(n)})),e.click()):o(new Error("提供的元素不是文件输入类型。"))}))),function(e,t){if(void 0!==e.initialRot){if(!Array.isArray(e.initialRot)||6!==e.initialRot.length||e.initialRot.some((e=>"number"!=typeof e)))throw new Error("initialRot 字段必须是包含 6 个实数的数组。");if((0!==e.initialRot[2]||0!==e.initialRot[4]||0!==e.initialRot[5])&&!t)throw new Error("initialRot 字段的索引 2、4、5 上的值在非 4D 模式下必须为 0。")}if(void 0!==e.initialOfs){if(!t)throw new Error("initialOfs 字段的只在 4D 模式下可用。");if(!Array.isArray(e.initialOfs)||4!==e.initialOfs.length||e.initialOfs.some((e=>"number"!=typeof e)))throw new Error("initialOfs 字段必须是包含 4 个实数的数组。")}if(void 0!==e.initialOfs3&&(!Array.isArray(e.initialOfs3)||3!==e.initialOfs3.length||e.initialOfs3.some((e=>"number"!=typeof e))))throw new Error("initialOfs3 字段必须是包含 3 个实数的数组。");if(void 0!==e.initialVerticesEdgesDim&&("number"!=typeof e.initialVerticesEdgesDim||e.initialVerticesEdgesDim<=0))throw new Error("initialVerticesEdgesDim 字段必须是正实数。");if(void 0!==e.initialProjDist){if(!t)throw new Error("initialProjDist 字段的只在 4D 模式下可用。");if("number"!=typeof e.initialProjDist||e.initialProjDist<=0)throw new Error("initialProjDist 字段必须是正实数。")}if(void 0!==e.initialFaceOpacity&&("number"!=typeof e.initialFaceOpacity||e.initialFaceOpacity<0||e.initialFaceOpacity>1))throw new Error("initialFaceOpacity 字段必须是 0~1 之间的实数。");if(void 0!==e.initialVisibilities){const t=["faces","wireframe","vertices","axes"];for(const[o,i]of Object.entries(e.initialVisibilities)){if(!t.includes(o))throw new Error(`initialVisibilities 字段包含无效的目标类型: ${o}。`);if("boolean"!=typeof i)throw new Error(`initialVisibilities.${o} 字段必须为布尔值。`)}}if(void 0!==e.initialCameraProjMethod&&!["persp","ortho"].includes(e.initialCameraProjMethod))throw new Error('initialCameraProjMethod 字段必须为 "persp" 或 "ortho"。');if(void 0!==e.initialSchleProjEnable){if(!t)throw new Error("initialSchleProjEnable 字段的只在 4D 模式下可用。");if("boolean"!=typeof e.initialSchleProjEnable)throw new Error("initialSchleProjEnable 字段必须为布尔值。")}if(void 0!==e.initialHighlightConfig){if(!t)throw new Error("initialHighlightConfig 字段的只在 4D 模式下可用。");for(const[t,o]of Object.entries(e.initialHighlightConfig)){if(!/^(0x)?[0-9a-fA-F]{8}$/.test(t))throw new Error(`initialHighlightConfig 的十六进制 RGBA 色码 ${t} 无效。`);F(o,`initialHighlightConfig.${t}.`)}}if(void 0!==e.initialHighlightFacesConfig){if(t)throw new Error("initialHighlightFacesConfig 字段的只在 3D 模式下可用。");for(const[t]of Object.entries(e.initialHighlightFacesConfig))if(!/^(0x)?[0-9a-fA-F]{8}$/.test(t))throw new Error(`initialHighlightFacesConfig 的十六进制 RGBA 色码 ${t} 无效。`)}if(!Array.isArray(e.actions)||e.actions.some((e=>!(e instanceof Object))))throw new Error("action 字段必须为对象列表。");e.actions.forEach(((e,o)=>{switch(e.type){case"rot":if("number"!=typeof e.angle)throw new Error(`actions[${o}] 操作的 angle 字段必须为实数。`);if(!(Number.isInteger(e.plane)&&0<=e.plane&&e.plane<=5))throw new Error(`actions[${o}] 操作的 plane 字段必须为大于等于零小于六的整数。`);if(!t&&[2,4,5].includes(e.plane))throw new Error(`actions[${o}] 操作的 plane 字段值 ${e.plane} 只在四维模式可用。`);break;case"trans4":if(!t)throw new Error(`actions[${o}] 操作只在四维模式可用。`);if(4!==e.ofs.length||e.ofs.some((e=>"number"!=typeof e)))throw new Error(`actions[${o}] 操作的 ofs 字段必须为四个实数的数组。`);break;case"trans3":if(3!==e.ofs.length||e.ofs.some((e=>"number"!=typeof e)))throw new Error(`actions[${o}] 操作的 ofs 字段必须为三个实数的数组。`);break;case"setVerticesEdgesDim":if("number"!=typeof e.dimOfs)throw new Error(`actions[${o}] 操作的 dimOfs 字段必须为实数。`);break;case"setProjDist":if(!t)throw new Error(`actions[${o}] 操作只在四维模式可用。`);if("number"!=typeof e.projDistOfs)throw new Error(`actions[${o}] 操作的 projDistOfs 字段必须为实数。`);break;case"setFaceOpacity":if("number"!=typeof e.faceOpacityOfs)throw new Error(`actions[${o}] 操作的 faceOpacityOfs 字段必须为实数。`);break;case"setVisibility":if(!["faces","wireframe","vertices","axes"].includes(e.target))throw new Error(`actions[${o}] 操作的 target 字段值必须为 faces、wireframe、vertices 或 axes 中的一者。`);if("boolean"!=typeof e.visibility)throw new Error(`actions[${o}] 操作的 visibility 字段值必须为 boolean 类型。`);break;case"setCameraProjMethod":if("persp"!==e.projMethod&&"ortho"!==e.projMethod)throw new Error(`actions[${o}] 操作的 projMethod 字段值必须为 persp 或 ortho 中的一者。`);break;case"setSchleProjEnable":if(!t)throw new Error(`actions[${o}] 操作只在四维模式可用。`);if("boolean"!=typeof e.enable)throw new Error(`actions[${o}] 操作的 enable 字段值必须为 boolean 类型。`);break;case"highlightCells":if(!t)throw new Error(`actions[${o}] 操作只在四维模式可用。`);for(const[t,i]of Object.entries(e.highlightConfig)){if(!/^(0x)?[0-9a-fA-F]{8}$/.test(t))throw new Error(`actions[${o}].highlightConfig 的十六进制 RGBA 色码 ${t} 无效。`);F(i,`actions[${o}].highlightConfig.${t}.`)}break;case"highlightFaces":if(t)throw new Error(`actions[${o}] 操作只在三维模式可用。`);for(const[t]of Object.entries(e.highlightConfig))if(!/^(0x)?[0-9a-fA-F]{8}$/.test(t))throw new Error(`actions[${o}].highlightConfig 的十六进制 RGBA 色码 ${t} 无效。`);break;default:throw new Error(`actions[${o}] 操作的类型 ${e.type} 无效。`)}if(Object.hasOwnProperty.call(e,"start")&&Object.hasOwnProperty.call(e,"end")&&Object.hasOwnProperty.call(e,"at"))throw new Error(`actions[${o}] 要么同时拥有 start 和 end 字段，要么只拥有 at 字段。`);if(Object.hasOwnProperty.call(e,"start")&&Object.hasOwnProperty.call(e,"end")){if(["setVisibility","setCameraProjMethod","setSchleProjEnable","highlightCells","highlightFaces"].includes(e.type))throw new Error(`actions[${o}] 的 start 和 end 字段值只适用于以下类型的操作：rot、trans4、trans3、setVerticesEdgesDim、setProjDist、setFaceOpacity。`);if(!Number.isInteger(e.start)||!Number.isInteger(e.end)||e.end<e.start||e.start<0||e.end<0)throw new Error(`actions[${o}] 的 start 和 end 字段必须均为大于等于 0 的整数，且 end 大于等于 start。`);if(Object.hasOwnProperty.call(e,"interp")&&"sin"!==e.interp&&"linear"!==e.interp)throw new Error(`actions[${o}] 的 interp 字段必须为 sin 或 linear。`)}else{if(!Object.hasOwnProperty.call(e,"at"))throw new Error(`actions[${o}] 要么同时拥有 start 和 end 字段，要么只拥有 at 字段。`);if(!["setVisibility","setCameraProjMethod","setSchleProjEnable","highlightCells","highlightFaces"].includes(e.type))throw new Error(`actions[${o}] 的 at 字段值只适用于以下类型的操作：setVisibility、setCameraProjMethod、setSchleProjEnable、highlightCells, highlightFaces。`);if(!Number.isInteger(e.at)||e.at<0)throw new Error(`actions[${o}] 的 at 字段必须为大于等于 0 的整数。`);if(Object.hasOwnProperty.call(e,"interp"))throw new Error(`actions[${o}] 为瞬时操，不能用interp字段。`)}}))}(this.recordConfig,this.is4D)}catch(e){return this.triggerErrorDialog(e.message),void console.error(e)}var e;this.recordConfig.actions.forEach(((e,t,o)=>{Object.hasOwnProperty.call(e,"start")&&Object.hasOwnProperty.call(e,"end")&&(o[t].interps=("sin"===e.interp?A:U)(e.end-e.start+1))})),this.isRecordingFlag=!0,this.updateEnable(!1),this.recordStates={rots:{Infinity:this.recordConfig.initialRot?j(...this.recordConfig.initialRot):this.rotUni.value},ofs:this.recordConfig.initialOfs?new i.IUQ(...this.recordConfig.initialOfs):this.ofsUni.value,ofs3:this.recordConfig.initialOfs3?new i.Pq0(...this.recordConfig.initialOfs3):this.ofs3Uni.value,verticesEdgesDim:this.recordConfig.initialVerticesEdgesDim??this.cylinderRadiusUni.value*this.scaleFactor,projDist:this.recordConfig.initialProjDist??this.projDistUni.value,faceOpacity:this.recordConfig.initialFaceOpacity??+this.faceOpacitySlider.noUiSlider.get(!0),visibilities:this.recordConfig.initialVisibilities??{faces:this.faceVisibleSwitcher.checked,wireframe:this.wireframeVisibleSwitcher.checked,vertices:this.verticesVisibleSwitcher.checked,axes:this.axisVisibleSwitcher.checked},cameraIsPersp:this.recordConfig.initialCameraProjMethod?"persp"===this.recordConfig.initialCameraProjMethod:this.perspSwitcher.checked,schleProjEnable:this.recordConfig.initialSchleProjEnable??!this.isOrthoUni.value,highlightConfig:this.recordConfig.initialHighlightConfig??a.Ay.load(this.editor.state.doc.toString()),highlightFacesConfig:this.recordConfig.initialHighlightFacesConfig??a.Ay.load(this.editor.state.doc.toString())};const t=Math.max(...this.recordConfig.actions.map(((e,t)=>(e.index=t,e.end??e.at??-1))))+(this.recordConfig.endExtraFrames??30);this.rotAngles=[0,0,0,0,0,0],this.rotUni.value=new i.kn4,this.stopRenderLoop(),this.controls.dispose(),this.capturer=new(d())({format:"webm",framerate:30,name:"Animation",verbose:!0}),this.capturer.start();let o=0;const r=(e=!1)=>{this.capturer.stop(),e||this.capturer.save(),this.capturer=null,this.isRecordingFlag=!1,this.updateProperties(),this.updateProjectionDistance(),this.updateRotation(),this.highlightCells(a.Ay.load(this.editor.state.doc.toString())),this._initializeControls(),this.startRenderLoop(),this.updateEnable()},n=()=>{if(o>=t||this.stopRecordFlag)return r(),void(this.stopRecordFlag=!1);try{this.genFrame(o),this.capturer.capture(this.canvas)}catch(e){return this.triggerErrorDialog(e.message),r(!0),void console.error(e)}o++,requestAnimationFrame(n)};n()}genFrame(e){this.updateRecordStates(e);const{rots:t,ofs:o,ofs3:r,verticesEdgesDim:n,projDist:a,faceOpacity:s,visibilities:c,cameraIsPersp:l,schleProjEnable:h}=this.recordStates,d=(f=t,Object.entries(f).sort((([e],[t])=>+t-+e)).map((([,e])=>e))).reduce(((e,t)=>{const o=new i.kn4;return o.multiplyMatrices(e,t),o}),(new i.kn4).identity());var f;this.camera.position.set(0,0,120),this.camera.rotation.set(0,0,0),this.rotUni.value=d,this.ofsUni.value=o,this.ofs3Uni.value=r,this.sphereRadiusUni.value=2*n/this.scaleFactor,this.cylinderRadiusUni.value=n/this.scaleFactor,this.projDistUni.value=a,this.isOrthoUni.value=!h,M(this.facesGroup,"opacity",s),M(this.facesGroup,"transparent",1!==s),M(this.facesGroup,"visible",c.faces??!0),M(this.wireframeGroup,"visible",c.wireframe??!0),M(this.verticesGroup,"visible",c.vertices??!0),M(this.axesGroup,"visible",c.axes??!0),this.toggleCamera(l),this.highlightCells(this.recordStates.highlightConfig),this.highlightFaces(this.recordStates.highlightFacesConfig),this.render()}updateRecordStates(e){const t=this.recordConfig.actions.filter((t=>t.start<=e&&e<=t.end||e===t.at));for(const o of t){const t=e-o.start,r=o.interps;switch(o.type){case"rot":{const e=[0,0,0,0,0,0];e[o.plane]=o.angle*r[t],this.recordStates.rots[o.index]?this.recordStates.rots[o.index].multiply(j(...e)):this.recordStates.rots[o.index]=j(...e);break}case"trans4":this.recordStates.ofs.add(new i.IUQ(...o.ofs).multiplyScalar(r[t]));break;case"trans3":this.recordStates.ofs3.add(new i.Pq0(...o.ofs).multiplyScalar(r[t]));break;case"setVerticesEdgesDim":if(this.recordStates.verticesEdgesDim+=o.dimOfs*r[t],this.recordStates.verticesEdgesDim<=0)throw new Error(`actions[${o.index}] 错误地导致边和顶点的尺寸为负数。`);break;case"setProjDist":if(this.recordStates.projDist+=o.projDistOfs*r[t],this.recordStates.projDist<=0)throw new Error(`actions[${o.index}] 错误地导致投影距离为负数。`);break;case"setFaceOpacity":if(this.recordStates.faceOpacity+=o.faceOpacityOfs*r[t],this.recordStates.faceOpacity<0||this.recordStates.faceOpacity>1)throw new Error(`actions[${o.index}] 错误地导致面透明度超出 0~1 的范围。`);break;case"setVisibility":this.recordStates.visibilities[o.target]=o.visibility;break;case"setCameraProjMethod":this.recordStates.cameraIsPersp="persp"===o.projMethod;break;case"setSchleProjEnable":this.recordStates.schleProjEnable=o.enable;break;case"highlightCells":this.recordStates.visibilities.faces=!(o.hideFaces??1),this.recordStates.highlightConfig=o.highlightConfig;break;case"highlightFaces":this.recordStates.visibilities.faces=!(o.hideFaces??1),this.recordStates.highlightFacesConfig=o.highlightConfig}}}};[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new n.m_(e)))}},n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={id:e,loaded:!1,exports:{}};return r[e].call(o.exports,o,o.exports,a),o.loaded=!0,o.exports}a.m=r,e=[],a.O=function(t,o,i,r){if(!o){var n=1/0;for(h=0;h<e.length;h++){o=e[h][0],i=e[h][1],r=e[h][2];for(var s=!0,c=0;c<o.length;c++)(!1&r||n>=r)&&Object.keys(a.O).every((function(e){return a.O[e](o[c])}))?o.splice(c--,1):(s=!1,r<n&&(n=r));if(s){e.splice(h--,1);var l=i();void 0!==l&&(t=l)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[o,i,r]},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},o=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},a.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var r=Object.create(null);a.r(r);var n={};t=t||[null,o({}),o([]),o(o)];for(var s=2&i&&e;"object"==typeof s&&!~t.indexOf(s);s=o(s))Object.getOwnPropertyNames(s).forEach((function(t){n[t]=function(){return e[t]}}));return n.default=function(){return e},a.d(r,n),r},a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,o){return a.f[o](e,t),t}),[]))},a.u=function(e){return"js/"+e+"."+{83:"4b7f7cde9feeb5e43662",119:"ea13bbd0f2c6de03a141",152:"775228296ba443ca0483",198:"1a05538e3e2d77fc23c3",207:"5d928e98da624bf64597",243:"be7d421dd64e372278c1",328:"c7533a749a5fea650b1c",336:"6b50ef479f186647f6ed",356:"0d15bf04321492a32a56",387:"1c603674f42e96000ee9",507:"d591b036d04b51733490",712:"c6308ff963b0267ab86b",787:"8bbfbbcaa6cd2a7f0991",858:"c33faa778e25504e6774",915:"04578b1d22c9a56c41ff",925:"5dcf73694633c955d7e3",1031:"befce2f67b708022bfa0",1100:"b51fb30caa6f7e01f332",1108:"3b89cd13bbeaf854fa5a",1114:"3f0c856cd464c4bdf123",1120:"d19090b56bd0b1fc4e29",1290:"eaf2d6a8b131c403109c",1337:"7b4998c44e6b288064eb",1429:"1a59eee8054d71bd44dc",1540:"6a44bf54622792699928",1542:"841269288dcd42019739",1561:"456aafbaa6e2afa51b61",1575:"9fe4e17f8cae112d1aa9",1669:"2b435ce1581f2a8f3123",1693:"7bd20c57a7304434667a",1699:"52dd697fb8013659fab9",1717:"ba29171a074c4052cf13",1906:"f2b459f41ecc6696b172",1934:"020fa6517703ae82126c",1952:"d21b1f7aeb2b79331d22",1954:"14e0b4baa5b564719d72",1959:"5d513fe7568f0dc17fb7",1999:"a059967a03738e2b2743",2069:"620d00c26e8b6a93cb30",2102:"745721dbef7356a394fd",2129:"52b740360517d769b86f",2191:"acf86b97b5069a308430",2249:"04df98a88dbb19506aa3",2260:"d1bb0cdea30dc44010cf",2309:"5a9f1fce843c3a1b1e93",2364:"fc9f31b50681fb4ccc87",2393:"d1d662b5f8f27154f6dd",2437:"0e932946b2e57a1237c1",2453:"bbe6ff32c24159f4ae5e",2531:"d16a8d7a0f005132f794",2535:"3afa31061ae384ed2456",2552:"cff0c6664bb0d3c5ca74",2558:"7a8539aebb35fc29d3e1",2573:"a68c724e27c153a1b611",2616:"0cb3aed81d8d33a6cb9f",2752:"37712de474266ace604b",2834:"e6d3e55d84d245e1f63c",2877:"41b7c401b7c3e1f18ffe",2893:"42eb991883bcb6ec28e0",2993:"a4507371b304207f583e",3125:"1f8de43d6da6145f2b86",3218:"71f1580146baef1bd422",3233:"46614fcf06268a843041",3320:"ac024eb870927fedb201",3325:"db5aec9c322de52e904a",3371:"d37a1e22a362a3519c71",3401:"2df202415b3b34d49e76",3404:"2e7a4d5e15e4d5e7a3fe",3419:"d5dab4879de47a09eaf3",3468:"a7bf6bfe362bba04f26f",3502:"6d9d063d017efc939ec0",3595:"f970edff54437895e596",3663:"15f8903d3d9a5b06dba1",3717:"f4d741b904fc3f173e0f",3761:"d9ecd6d715eea3c0c3f8",3810:"13476f2a0d859cc738ab",3817:"71d348ae9670a0b751ea",3841:"e04ff2b20c4d7d242f4b",3866:"8192073768272e13d8ca",3889:"ec66e85106b47d3e4da5",3931:"cc0443f6d088166c5dac",3958:"35e9d1933a6910c43dde",3965:"ac1dfd285dfa86824111",3973:"90b26580d6642e620eca",4045:"c2e06c2a9defebaa052f",4091:"8c55e95ce3f7ef884038",4223:"12ca7f4cafa0fac5e300",4248:"dc589273e4ad9b711aa6",4291:"bde4a2e10a8889364cb2",4312:"8039ffe60a56125b7da6",4316:"8e5c604a10d65ec31917",4320:"3a972336bb160080e414",4354:"e1ba60b747dd6365e38d",4423:"ce0fc62beacd3baf222a",4437:"631af8ff1330667c731d",4491:"4d3626f355f59c7d088a",4533:"86a6007869ffcd092074",4540:"47b07cbf555e1e21c252",4574:"4c9fab99cebf414e5682",4597:"4af11fb6a67b4539af89",4632:"2461aac394bcae0bdb4d",4660:"e2557372f4c3ebc506e0",4668:"2f8a25d02c56dabb692e",4674:"4472f952353c0ae54005",4739:"3ff910e666ad5ac61f68",4773:"d61ac1985f4898fa7a52",4810:"821551b3dab156589808",4830:"c90fb3b419e9df43f1f4",4878:"5ab3287c3ca588e93f9a",4999:"d29de00ca3a13f5f41ab",5013:"9fa380b22484b527ab4c",5064:"1c0c6aa544f0e975f192",5084:"fe71c1ef005d0bd824d1",5138:"2e58182c655fbdfe8f97",5187:"324074d462feb15057ee",5228:"169cad2a5a6164a1c86c",5261:"9e22a427360ce068d125",5274:"373eddd97809af280cbe",5327:"6be90d575f1486311328",5337:"131f7309e70c68b42027",5430:"e75ef2a8e5a94506b02d",5433:"c1c4d77fd0b316e3aed6",5443:"30714a02ba90df53b24c",5477:"d0605f241579ddc477d9",5501:"b4efb65def8cdf5ceb1f",5515:"150f7f8c26ef718fe5a8",5605:"3b448247cfa2bd363b91",5616:"8a2589b2449058edd46d",5644:"6d2d5756669b7ffd0b53",5662:"a18cf0328695a447b14c",5752:"668c83a5fb8bbbf3f671",5842:"7b499fb6facbb522b280",5944:"2c3daf2e4fca55c2d867",5965:"4852a2b039126f76a4ad",6018:"9cd7424c090381fc7f80",6047:"4977fb22eefc3d9fd7ad",6066:"d7143e58d55a3a5f32a5",6088:"26529cb257475ab8ba4d",6145:"f445ea208607da2593c0",6219:"0fb9c1a6eae67d59dc44",6236:"59b77a31e9716cad5f82",6345:"62f5244f76d9342ec0a3",6402:"cb6e0f9c03e7af466261",6466:"0ad0d080f9f529372f7e",6485:"c077e4c2324c1cb2a395",6538:"b3c84611f5435c2d264e",6542:"245eaeba2bd3d3c09f04",6574:"dd44fc646091955e7032",6647:"52f6d50b4759720eccdc",6676:"c33ce841854c668acffe",6763:"06628634a65aa592a2db",6777:"0f2497888e0a299ae90c",6898:"019127fd749c604d896c",6909:"07ef84bd88b25909d296",6930:"99ac794e43968513a4d6",6931:"dfccc200648994f1bcbf",6970:"15a2cff9a9a9c513faf8",6981:"ad3a3e5bcef14c6839b2",6998:"c0b958a9c0566ccedc86",7028:"e4dc5b269595c5dbb412",7157:"0d2109f6d6a700363430",7216:"1e1e191d5c12ed582d2a",7236:"367513cf59e3fee24817",7241:"3fe3a89309e39ea94cbb",7255:"e590e874b70ea28dad1b",7257:"0ad0293c72498776ae18",7267:"d8ee037ff4355930fac3",7356:"860aa53560b28c671f20",7357:"50601d55925748a51b25",7367:"2e433d58240a4bb1033c",7401:"8787844d32b4f96e7069",7461:"f17b5d913350a5ab85d6",7477:"7327adf08ab835e8be2e",7557:"b80507fc455729445925",7560:"dfe6041f5b5a4a526b17",7567:"2c0c55f89106cfa3a755",7587:"018c3cccc762782ba041",7623:"062ae35b311db952b0b4",7766:"6b4148d5dde3eb5ceeff",7885:"d3805324ba6f2f5d8d6c",7916:"4d04bc1c16a74bf5c0ed",7937:"e57e3c9b56096612cc6f",8025:"68c897fc096b09467d32",8098:"4b8102ba18d357a46936",8099:"b0110e11ce23ffa92f8d",8145:"92943ba4b7930f5db59f",8245:"13fa044d54c0debd880e",8256:"8d5f88d86f2e339a7586",8293:"442362753f5ef76e6f9b",8352:"1dcb2e0f1b405404e25f",8410:"84bb11d3e3bddd8bd94d",8416:"206d2ea0e06ade22d8bb",8455:"174d9d8a863f4469a61d",8519:"28bc9236ecb043d77b2c",8535:"2099848b1d6286f76b1d",8558:"886f4de09e03a4645904",8568:"2379a2da7449a72fc646",8572:"5d328628628940126212",8629:"6079e954d5f7b06fbb4a",8665:"aa9d8164b3f2896571bf",8683:"9768162fc461ad4a874f",8819:"c6f2801470f66976f781",8834:"a17b475a02c8cf3f51f9",8837:"a96276e2966195a914a4",8846:"1b9bf6ebf761110e0316",8864:"a5d48c1d74339390acb0",8926:"546c68bc988cc7a6f282",8993:"a1825233a692e2c82ef3",9011:"f82df49055dae1badf4f",9018:"3175faaff30a39ed3628",9048:"7fb0b98ddde8e81d00d6",9198:"ac916c14f35e6d7bbe3d",9305:"7197f12f9611c964cc7e",9319:"e668ef85d74f0c33da04",9322:"5c76866ebb3aa9b5cd3e",9339:"ed6614d1de43505ebc86",9378:"b13fd46542ee11b9807e",9401:"b032fe844efef612da4c",9436:"a1219c3b6e59168581cd",9469:"ee81689cd1753e18dbab",9545:"5f67676f458e4bb8b9d3",9598:"4e6915e9140b1e36cf98",9787:"4238054c2b0defa484da",9835:"0b9846a972a56536c8d6",9871:"373f6a98789292e92c88",9883:"466153497ce658af2c4c",9890:"32f7652725e0c99e2186",9923:"f2bfd8420f96802545b7",9930:"8607ba724db22056ea07",9932:"47739ceb2abc8d0115fd",9940:"b2312b85c34753f1e6a8",9976:"a2bc595178a5b69321bc",9981:"d4de76392e61ca56a560",9983:"ee32b23feed6a1d0a774",9987:"2cf86e8515c2c0292690",9990:"e3fae81114687660cce8"}[e]+".chunk.js"},a.miniCssF=function(e){},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i={},a.l=function(e,t,o,r){if(i[e])i[e].push(t);else{var n,s;if(void 0!==o)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var h=c[l];if(h.getAttribute("src")==e){n=h;break}}n||(s=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,a.nc&&n.setAttribute("nonce",a.nc),n.src=e),i[e]=[t];var d=function(t,o){n.onerror=n.onload=null,clearTimeout(f);var r=i[e];if(delete i[e],n.parentNode&&n.parentNode.removeChild(n),r&&r.forEach((function(e){return e(o)})),t)return t(o)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=d.bind(null,n.onerror),n.onload=d.bind(null,n.onload),s&&document.head.appendChild(n)}},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},a.j=3057,function(){var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var i=o.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=o[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e+"../"}(),function(){a.b=document.baseURI||self.location.href;var e={3057:0};a.f.j=function(t,o){var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)o.push(i[2]);else{var r=new Promise((function(o,r){i=e[t]=[o,r]}));o.push(i[2]=r);var n=a.p+a.u(t),s=new Error;a.l(n,(function(o){if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=o&&("load"===o.type?"missing":o.type),n=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+n+")",s.name="ChunkLoadError",s.type=r,s.request=n,i[1](s)}}),"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,r,n=o[0],s=o[1],c=o[2],l=0;if(n.some((function(t){return 0!==e[t]}))){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(c)var h=c(a)}for(t&&t(o);l<n.length;l++)r=n[l],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(h)},o=self.webpackChunk=self.webpackChunk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var s=a.O(void 0,[8096],(function(){return a(7327)}));s=a.O(s)}();